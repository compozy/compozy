id: code-format
$use: agent(local::agents.#(id=="code-assistant"))
action: format
input:
  type: object
  properties:
    code:
      type: string
    language:
      type: string
    indent_size:
      type: integer
    use_tabs:
      type: boolean
  required:
    - code
output:
  type: object
  properties:
    formatted_code:
      type: string
  required:
    - formatted_code
env:
  FORMATTER_VERSION: "1.0.0"
with:
  code: "console.log('hello')"
  language: "javascript"
  indent_size: 2
  use_tabs: false
outputs:
  # Simple field mapping
  formatted_result: "{{ .output.formatted_code }}"
  # Computed values combining multiple sources
  summary: "Formatted {{ .with.language }} code with {{ .with.indent_size }} spaces using {{ .env.FORMATTER_VERSION }}"
  # Nested object creation
  metadata:
    language: "{{ .with.language }}"
    indent_size: "{{ .with.indent_size }}"
    formatter_version: "{{ .env.FORMATTER_VERSION }}"
    timestamp: "{{ now }}"
  # Conditional output based on input
  has_tabs: "{{ eq .with.use_tabs true }}"
on_success:
  next: next-task
on_error:
  next: retry-task
