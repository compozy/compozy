id: review
version: 0.1.0
description: Review Go code for a given directory

schemas:
  - id: review_input
    type: object
    properties:
      directory:
        type: string
        description: The directory to review
    required:
      - directory
  - id: list_files_input
    type: object
    properties:
      dir:
        type: string
        description: The directory to list files from
      exclude:
        type: string
        description: Pattern to exclude files (optional)
    required:
      - dir
  - id: write_file_input
    type: object
    properties:
      path:
        type: string
        description: The file path to write to
      content:
        type: string
        description: The content to write
    required:
      - path
      - content
  - id: read_file_input
    type: object
    properties:
      path:
        type: string
        description: The file path to read
    required:
      - path

config:
  input: review_input

tools:
  - id: list_files
    description: List all files in the given directory
    input: list_files_input
  - id: write_file
    description: Write content to a file
    input: write_file_input
  - id: read_file
    description: Read the contents of a file
    input: read_file_input

tasks:
  - id: review
    type: basic
    tool: list_files
    with:
      dir: "{{ .workflow.input.directory }}"
      exclude: "!*.go"
    on_success:
      next: review_files

  - id: review_files
    type: collection
    mode: parallel
    items: "{{ .tasks.review.output.files }}"
    item_var: file
    final: true
    task:
      id: "process-{{ .index }}"
      type: basic
      agent: analyzer
      action: analyze
      with:
        file_path: "{{ .workflow.input.directory }}/{{ .file }}"
