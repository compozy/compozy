id: review
version: 0.1.0
description: Review Go code for a given directory

schemas:
  - id: review_input
    type: object
    properties:
      directory:
        type: string
        description: The directory to review
    required:
      - directory

config:
  input: review_input

tasks:
  - id: review
    type: basic
    tool: cp__list_files
    with:
      dir: "{{ .workflow.input.directory }}"
      exclude: "!*.go"
    on_success:
      next: review_files

  - id: review_files
    type: collection
    mode: parallel
    items: "{{ .tasks.review.output.files }}"
    item_var: file
    final: true
    task:
      id: "process-{{ .index }}"
      type: basic
      agent: analyzer
      action: analyze
      with:
        file_path: "{{ .workflow.input.directory }}/{{ .file }}"
