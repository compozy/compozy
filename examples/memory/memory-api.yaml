id: memory-api
version: 0.1.0
description: Simple agent with memory for testing REST API endpoints

config:
  input:
    type: object
    properties:
      user_id:
        type: string
        description: Unique identifier for the user
        default: "api_test_user"
      message:
        type: string
        description: User message
        default: "Hello, what do you remember about me?"
    required:
      - user_id
      - message

agents:
  - id: memory_agent
    config:
      $ref: global::models.#(provider=="groq")
      temperature: 0.7
      max_tokens: 500
    memory: true
    memories:
      - user_memory
    memory_key: "user:{{.workflow.input.user_id}}"
    instructions: |
      You are a helpful assistant that can remember information about users.
      Use your memory to provide personalized responses based on what you know about the user.
      If you don't have any memory about the user, let them know this is a new conversation.
    actions:
      - id: chat
        json_mode: true
        prompt: |
          User ID: {{ .workflow.input.user_id }}
          User Message: {{ .workflow.input.message }}

          Please respond to the user's message. Use any information you remember about them to personalize your response.
        output:
          type: object
          properties:
            response:
              type: string
              description: Your response to the user
          required:
            - response

resources:
  memories:
    - id: user_memory
      source: ./memory/user_memory.yaml

tasks:
  # Simple chat with memory
  - id: chat
    type: basic
    $use: agent(local::agents.#(id="memory_agent"))
    action: chat
    final: true

outputs:
  response: "{{ .tasks.chat.output.response }}"
  user_id: "{{ .workflow.input.user_id }}"
  message: "{{ .workflow.input.message }}"
