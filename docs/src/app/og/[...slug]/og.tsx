import type { ImageResponseOptions } from "next/dist/compiled/@vercel/og/types";
import { ImageResponse } from "next/og";
import type { ReactElement, ReactNode } from "react";

interface GenerateProps {
  title: ReactNode;
  description?: ReactNode;
  primaryTextColor?: string;
  logoUrl?: string;
}

export function generateOGImage(options: GenerateProps & ImageResponseOptions): ImageResponse {
  const { title, description, primaryTextColor, logoUrl, ...rest } = options;
  return new ImageResponse(
    generate({
      title,
      description,
      primaryTextColor,
      logoUrl,
    }),
    {
      width: 1200,
      height: 630,
      ...rest,
    }
  );
}

export function generate({
  primaryTextColor = "rgb(255,255,255)",
  logoUrl,
  ...props
}: GenerateProps & { logoUrl?: string }): ReactElement {
  return (
    <div
      style={{
        display: "flex",
        flexDirection: "column",
        width: "100%",
        height: "100%",
        color: "white",
        background: "linear-gradient(to bottom, #161716 0%, #161716 100%)",
        position: "relative",
      }}
    >
      {/* Content */}
      <div
        style={{
          display: "flex",
          flexDirection: "column",
          width: "100%",
          height: "100%",
          padding: "4rem",
          position: "relative",
        }}
      >
        <p
          style={{
            fontFamily: "Clash",
            fontWeight: 600,
            fontSize: "76px",
            margin: 0,
            marginBottom: "1rem",
          }}
        >
          {props.title}
        </p>
        <p
          style={{
            fontFamily: "Geist",
            fontSize: "48px",
            color: "rgba(240,240,240,0.7)",
            margin: 0,
          }}
        >
          {props.description}
        </p>
        <div
          style={{
            display: "flex",
            marginTop: "auto",
          }}
        >
          {logoUrl && (
            <svg
              width="300"
              height="69"
              viewBox="0 0 760 176"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M159.056 100.753C156.815 96.0489 153.697 91.7024 150.151 87.819C155.329 81.3541 159.761 73.3236 160.801 63.0367C162.457 46.6626 156.018 31.2075 142.84 19.6964C133.323 11.3821 120.435 5.27452 106.654 2.46068C76.3959 -3.71808 46.583 5.4525 26.0835 25.3293C16.417 34.7019 9.05052 46.2766 4.70324 58.8379C0.168342 71.9403 -1.11498 86.2988 0.974407 100.457C4.18912 122.241 15.7666 141.959 34.2357 156.14C48.8218 167.34 66.681 174.121 85.2728 175.3C91.2131 175.676 97.2104 175.479 103.168 174.675C122.149 172.114 147.097 160.779 158.107 140.884C165.046 128.346 165.386 114.033 159.056 100.753Z"
                fill="url(#paint0_linear_2_13)"
              />
              <path
                opacity="0.929"
                fillRule="evenodd"
                clipRule="evenodd"
                d="M145.986 109.835C142.19 101.525 132.927 93.5069 125.026 89.2936C125.028 89.291 125.031 89.288 125.033 89.2854C125.031 89.2837 125.028 89.2824 125.026 89.2807C133.386 80.2522 144.589 71.931 145.876 58.5699C146.018 57.1018 146.064 55.668 146.023 54.2689C145.385 33.2279 124.926 20.3414 106.292 16.1353C58.9327 5.44523 16.7639 41.1902 16.5931 87.5516C16.5796 91.4634 16.8617 95.4612 17.4637 99.5258C23.4464 139.933 63.3754 167.524 103.805 160.402C122.081 157.184 148.119 142.446 148.593 121.806C148.679 117.986 147.88 113.981 145.986 109.835ZM121.572 132.428C90.8856 156.112 46.3563 136.741 36.882 100.505C25.5668 54.6634 75.6491 17.0625 115.376 41.7043C126.201 48.4194 129.871 57.7416 120.91 68.9049C113.916 77.6174 101.428 98.5611 86.6934 97.8907C79.8614 97.5802 74.3407 92.2801 74.3407 85.3489C74.3407 78.4173 79.8542 72.7323 86.6934 72.6509C89.3094 72.6196 91.3171 75.0313 93.7505 74.7979C96.3214 74.5511 103.813 65.6115 105.405 63.8495C107.126 61.9453 103.006 59.558 101.54 58.8098C83.8289 49.7698 64.898 61.5511 59.3 79.4454C54.9419 93.3754 62.1441 108.676 74.8025 115.027C88.4355 121.868 101.241 119.445 112.746 109.753C114.24 108.494 117.408 104.724 118.877 103.967C119.624 103.582 121.469 105.272 122.129 105.798C123.808 107.136 126.875 110.047 128.315 111.62C136.009 120.023 128.386 127.169 121.572 132.428Z"
                fill="url(#paint1_linear_2_13)"
              />
              <path
                d="M696.588 154.43C693.12 154.43 690.413 153.338 688.418 151.153C686.423 148.968 685.378 145.69 685.283 141.415C688.133 141.938 690.508 142.223 692.503 142.223C696.92 142.223 700.435 140.988 703.048 138.47C705.66 135.953 708.415 131.393 711.36 124.79L714.21 118.188L683.525 43.0425C684.238 42.71 685.33 42.4725 686.66 42.235C688.038 41.9025 689.225 41.76 690.27 41.76C692.788 41.855 695.02 42.4725 697.015 43.66C699.105 44.8 700.53 46.3675 701.242 48.3625L720.86 98.8075L718.485 105.553L719.578 106.028L742.188 48.3625C742.9 46.2725 744.278 44.6575 746.273 43.47C748.268 42.33 750.5 41.76 753.018 41.76C754.063 41.76 755.25 41.9025 756.628 42.235C758.1 42.425 759.145 42.71 759.763 43.0425L724.565 129.303C721.098 137.805 717.203 144.075 712.785 148.16C708.51 152.34 703.048 154.43 696.445 154.43H696.588Z"
                fill="url(#paint2_linear_2_13)"
              />
              <path
                d="M618.878 121.75C617.12 121.75 615.647 121.133 614.46 119.85C613.32 118.473 612.75 116.905 612.75 115.148C612.75 113.675 613.178 112.393 613.985 111.205L664.097 51.355L663.29 50.7375L659.205 55.2975H624.957C621.727 55.2975 619.21 54.205 617.405 52.02C615.743 49.835 614.887 46.89 614.887 43.2325H674.595C676.495 43.2325 677.967 43.85 679.012 45.1325C680.152 46.2725 680.722 47.6975 680.722 49.36C680.722 51.1175 680.2 52.59 679.155 53.7775L629.517 113.343L630.325 114.15L634.077 109.733H671.175C674.405 109.733 676.875 110.873 678.538 113.2C680.295 115.385 681.198 118.283 681.198 121.845H618.83L618.878 121.75Z"
                fill="url(#paint3_linear_2_13)"
              />
              <path
                d="M577.267 123.175C570.665 123.175 564.728 121.988 559.503 119.565C554.278 117.143 550.145 113.865 547.105 109.685C544.16 105.41 542.688 100.613 542.688 95.3875V70.735C542.688 65.415 544.16 60.5225 547.105 56.105C550.05 51.6875 554.135 48.2675 559.36 45.75C564.585 43.1375 570.57 41.8075 577.267 41.8075C583.965 41.8075 589.95 43.1375 595.175 45.75C600.4 48.2675 604.485 51.735 607.43 56.105C610.47 60.5225 611.99 65.3675 611.99 70.735V95.3875C611.99 100.613 610.47 105.41 607.43 109.685C604.485 113.865 600.352 117.19 595.032 119.565C589.807 121.988 583.87 123.175 577.267 123.175ZM577.267 109.637C583.252 109.637 587.955 108.26 591.423 105.553C594.89 102.703 596.6 98.9975 596.6 94.39V71.305C596.6 66.5075 594.843 62.6125 591.28 59.6675C587.813 56.7225 583.158 55.25 577.315 55.25C571.473 55.25 566.722 56.7225 563.16 59.6675C559.692 62.6125 557.983 66.46 557.983 71.305V94.39C557.983 98.9975 559.692 102.703 563.16 105.553C566.627 108.26 571.33 109.637 577.315 109.637H577.267Z"
                fill="url(#paint4_linear_2_13)"
              />
              <path
                d="M469.253 53.73C469.253 50.1675 470.44 47.27 472.862 45.085C475.38 42.9 479.085 41.8075 484.025 41.8075V50.4525C483.502 51.165 482.98 51.925 482.457 52.6375C481.935 53.255 481.413 53.9675 480.89 54.68L481.508 55.2975C484.738 51.0225 488.442 47.6975 492.527 45.4175C496.707 42.995 501.743 41.8075 507.633 41.8075C516.515 41.8075 523.688 44.3725 529.15 49.5025C534.708 54.5375 537.463 61.1875 537.463 69.4525V95.6725C537.463 103.937 534.518 110.587 528.675 115.622C522.928 120.657 515.422 123.175 506.207 123.175C501.695 123.175 497.372 122.225 493.145 120.325C488.965 118.33 485.355 115.765 482.315 112.63L481.84 113.437C482.552 114.482 483.692 115.622 485.117 116.905V143.125C485.117 150.772 479.845 154.572 469.253 154.572V53.73ZM503.5 109.495C509.343 109.495 513.902 108.165 517.18 105.552C520.41 102.94 522.073 99.33 522.073 94.7225V70.2125C522.073 65.51 520.457 61.9 517.18 59.3825C513.95 56.77 509.343 55.44 503.358 55.44C498.133 55.44 493.715 56.8175 490.152 59.525C486.685 62.1375 484.975 65.4625 484.975 69.405V95.4825C484.975 99.4725 486.638 102.797 490.01 105.552C493.478 108.165 497.99 109.495 503.5 109.495Z"
                fill="url(#paint5_linear_2_13)"
              />
              <path
                d="M358.815 54.49C358.815 45.9875 363.802 41.76 373.73 41.76V51.64C372.685 52.685 371.545 54.1575 370.262 56.0575L371.07 56.675C374.442 51.8775 377.91 48.1725 381.615 45.655C385.273 43.0425 389.643 41.7125 394.678 41.7125C404.083 41.7125 410.542 46.225 414.01 55.2025C419.852 46.1775 427.832 41.7125 437.902 41.7125C445.217 41.7125 450.965 44.23 455.05 49.265C459.23 54.3 461.32 60.855 461.32 68.8825V112.392C461.32 116.05 459.99 118.805 457.378 120.562C454.86 122.225 450.965 123.08 445.74 123.08V70.07C445.74 60.1425 441.703 55.155 433.628 55.155C429.21 55.155 425.457 56.675 422.322 59.715C419.282 62.66 417.762 66.7925 417.762 72.1125V112.487C417.762 116.24 416.527 118.995 414.01 120.657C411.492 122.32 407.693 123.175 402.562 123.175V70.07C402.562 65.4625 401.565 61.8525 399.57 59.24C397.575 56.5325 394.487 55.155 390.307 55.155C385.7 55.155 381.852 56.8175 378.86 60.19C375.915 63.42 374.443 67.5525 374.443 72.5875V112.487C374.443 116.145 373.112 118.9 370.5 120.657C367.983 122.32 364.087 123.175 358.862 123.175V54.49H358.815Z"
                fill="url(#paint6_linear_2_13)"
              />
              <path
                d="M315.163 123.175C308.56 123.175 302.623 121.988 297.398 119.565C292.173 117.143 288.04 113.865 285 109.685C282.055 105.41 280.583 100.613 280.583 95.3875V70.735C280.583 65.415 282.055 60.5225 285 56.105C287.945 51.6875 292.03 48.2675 297.255 45.75C302.48 43.1375 308.465 41.8075 315.163 41.8075C321.86 41.8075 327.845 43.1375 333.07 45.75C338.295 48.2675 342.38 51.735 345.325 56.105C348.365 60.5225 349.885 65.3675 349.885 70.735V95.3875C349.885 100.613 348.365 105.41 345.325 109.685C342.38 113.865 338.248 117.19 332.928 119.565C327.703 121.988 321.765 123.175 315.163 123.175ZM315.163 109.637C321.148 109.637 325.85 108.26 329.318 105.553C332.785 102.703 334.495 98.9975 334.495 94.39V71.305C334.495 66.5075 332.738 62.6125 329.175 59.6675C325.708 56.7225 321.053 55.25 315.21 55.25C309.368 55.25 304.618 56.7225 301.055 59.6675C297.588 62.6125 295.878 66.46 295.878 71.305V94.39C295.878 98.9975 297.588 102.703 301.055 105.553C304.523 108.26 309.225 109.637 315.21 109.637H315.163Z"
                fill="url(#paint7_linear_2_13)"
              />
              <path
                d="M246.81 123.175C240.302 123.175 234.507 122.035 229.377 119.708C224.342 117.285 220.4 114.008 217.597 109.828C214.747 105.553 213.37 100.66 213.37 95.1975V70.83C213.37 65.1775 214.747 60.1425 217.455 55.725C220.305 51.3075 224.2 47.935 229.235 45.5125C234.365 43.0425 240.16 41.76 246.667 41.76C252.747 41.76 258.115 42.6625 262.865 44.42C267.567 46.0825 271.225 48.505 273.885 51.64C276.592 54.775 277.97 58.385 277.97 62.47C277.97 65.415 276.782 67.7425 274.36 69.5475C271.937 71.21 268.897 71.97 265.24 71.7325C265.24 66.935 263.53 62.9925 260.062 59.9525C256.69 56.9125 252.367 55.3925 247 55.3925C241.632 55.3925 237.31 56.865 233.937 59.81C230.565 62.755 228.902 66.555 228.902 71.2575V94.2C228.902 98.7125 230.565 102.37 233.937 105.22C237.405 108.07 241.822 109.448 247.285 109.448C252.747 109.448 256.975 107.928 260.347 104.888C263.815 101.848 265.525 97.9525 265.525 93.25C269.277 92.9175 272.365 93.63 274.787 95.2925C277.21 96.955 278.397 99.2825 278.397 102.228C278.397 106.313 277.02 109.923 274.312 113.058C271.7 116.193 267.995 118.663 263.15 120.42C258.352 122.178 252.89 123.08 246.81 123.08V123.175Z"
                fill="url(#paint8_linear_2_13)"
              />
              <defs>
                <linearGradient
                  id="paint0_linear_2_13"
                  x1="25.2156"
                  y1="0.228606"
                  x2="137.553"
                  y2="168.101"
                  gradientUnits="userSpaceOnUse"
                >
                  <stop stop-color="#EAFA35" />
                  <stop offset="0.53" stop-color="#BCE41B" />
                  <stop offset="1" stop-color="#79A807" />
                </linearGradient>
                <linearGradient
                  id="paint1_linear_2_13"
                  x1="55.2468"
                  y1="23.5862"
                  x2="113.879"
                  y2="156.582"
                  gradientUnits="userSpaceOnUse"
                >
                  <stop stop-color="#102202" />
                  <stop offset="1" stop-color="#081500" />
                </linearGradient>
                <linearGradient
                  id="paint2_linear_2_13"
                  x1="224"
                  y1="48.5"
                  x2="732"
                  y2="149"
                  gradientUnits="userSpaceOnUse"
                >
                  <stop stop-color="white" />
                  <stop offset="1" stop-color="#D4D4D4" />
                </linearGradient>
                <linearGradient
                  id="paint3_linear_2_13"
                  x1="224"
                  y1="48.5"
                  x2="732"
                  y2="149"
                  gradientUnits="userSpaceOnUse"
                >
                  <stop stop-color="white" />
                  <stop offset="1" stop-color="#D4D4D4" />
                </linearGradient>
                <linearGradient
                  id="paint4_linear_2_13"
                  x1="224"
                  y1="48.5"
                  x2="732"
                  y2="149"
                  gradientUnits="userSpaceOnUse"
                >
                  <stop stop-color="white" />
                  <stop offset="1" stop-color="#D4D4D4" />
                </linearGradient>
                <linearGradient
                  id="paint5_linear_2_13"
                  x1="224"
                  y1="48.5"
                  x2="732"
                  y2="149"
                  gradientUnits="userSpaceOnUse"
                >
                  <stop stop-color="white" />
                  <stop offset="1" stop-color="#D4D4D4" />
                </linearGradient>
                <linearGradient
                  id="paint6_linear_2_13"
                  x1="224"
                  y1="48.5"
                  x2="732"
                  y2="149"
                  gradientUnits="userSpaceOnUse"
                >
                  <stop stop-color="white" />
                  <stop offset="1" stop-color="#D4D4D4" />
                </linearGradient>
                <linearGradient
                  id="paint7_linear_2_13"
                  x1="224"
                  y1="48.5"
                  x2="732"
                  y2="149"
                  gradientUnits="userSpaceOnUse"
                >
                  <stop stop-color="white" />
                  <stop offset="1" stop-color="#D4D4D4" />
                </linearGradient>
                <linearGradient
                  id="paint8_linear_2_13"
                  x1="224"
                  y1="48.5"
                  x2="732"
                  y2="149"
                  gradientUnits="userSpaceOnUse"
                >
                  <stop stop-color="white" />
                  <stop offset="1" stop-color="#D4D4D4" />
                </linearGradient>
              </defs>
            </svg>
          )}
        </div>
      </div>
    </div>
  );
}

export async function GET(request: Request) {
  const { searchParams, origin } = new URL(request.url);
  const title = searchParams.get("title") || "Compozy";
  const description =
    searchParams.get("description") || "Next-level Agentic Orchestration Platform";

  // Use the full logo URL
  const logoUrl = `${origin}/full_logo.png`;

  return new ImageResponse(
    generate({
      title,
      description,
      logoUrl,
    }),
    {
      width: 1200,
      height: 630,
    }
  );
}
