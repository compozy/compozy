---
title: Runtime
description: The runtime configuration controls how Compozy executes JavaScript/TypeScript tools using the Bun runtime engine. This configuration is part of your project's `compozy.yaml` file.
---

## Configuration Properties

The runtime configuration has three main properties:

- **`type`**: The JavaScript runtime (currently only `"bun"` is supported)
- **`entrypoint`**: Path to your tools file (typically `"./tools.ts"`)
- **`permissions`**: Bun security permissions for tool execution

<Tabs items={["Basic Example", "Common Setup", "Production Setup"]}>
<Tab>
```yaml title="compozy.yaml"
name: my-project
version: "1.0.0"

runtime:
  type: bun
  entrypoint: "./tools.ts"
  permissions:
    - --allow-read
```

This minimal configuration only allows reading files. Perfect for tools that process local data without network access.
</Tab>

<Tab>
```yaml title="compozy.yaml"
name: my-project
version: "1.0.0"

runtime:
  type: bun
  entrypoint: "./tools.ts"
  permissions:
    - --allow-read
    - --allow-net
    - --allow-env
```

Most common setup that allows file reading, network requests, and environment variable access.
</Tab>

<Tab>
```yaml title="compozy.yaml"
name: my-project
version: "1.0.0"

runtime:
  type: bun
  entrypoint: "./tools.ts"
  permissions:
    - --allow-read=/data
    - --allow-write=/output
    - --allow-net=api.example.com
    - --allow-env=API_KEY,DATABASE_URL
```

Production setup with scoped permissions for enhanced security.
</Tab>
</Tabs>

## Tool Entrypoint File

Your entrypoint file exports tools using a **default export object**. The keys in this object **must exactly match** the tool IDs used in your workflows:

```typescript title="tools.ts"
// Individual tool functions
export async function weatherTool(params: { city: string }) {
  const response = await fetch(`https://api.weather.com/v1/current?q=${params.city}`);
  return await response.json();
}

export async function saveDataTool(params: { data: any[], format: string }) {
  // Tool implementation
  return { saved: true, format };
}

// Default export - keys MUST match workflow tool IDs
export default {
  weather_tool: weatherTool,    // Matches tool ID "weather_tool" in workflow
  save_data: saveDataTool,      // Matches tool ID "save_data" in workflow
};
```

<Callout type="warning">
**Critical**: The keys in the default export object must exactly match the `id` values defined in your workflow's `tools` section. If they don't match, tools won't be found at runtime.
</Callout>

### Connecting Tools to Workflows

Here's how the entrypoint exports connect to workflow tool definitions:

<Tabs items={["Workflow Definition", "Entrypoint Exports"]}>
<Tab>
```yaml title="workflow.yaml"
tools:
  - id: weather_tool           # Tool ID
    description: Get weather data
  - id: save_data             # Tool ID
    description: Save data to file

tasks:
  - id: get_weather
    type: basic
    $use: tool(local::tools.#(id="weather_tool"))  # References tool ID
    with:
      city: "New York"
```
</Tab>

<Tab>
```typescript title="tools.ts"
export default {
  weather_tool: weatherTool,  // Key matches workflow tool ID
  save_data: saveDataTool,    // Key matches workflow tool ID
};
```

The runtime looks up tools by matching the workflow tool ID with the entrypoint export key.
</Tab>
</Tabs>

## Security Permissions

Compozy uses Bun's permission system to control what resources your tools can access. Always follow the principle of least privilege - only grant the permissions your tools actually need.

| Permission | Description | Examples |
|------------|-------------|----------|
| `--allow-read` | File system read access | `--allow-read`, `--allow-read=/data` |
| `--allow-write` | File system write access | `--allow-write`, `--allow-write=/output` |
| `--allow-net` | Network access | `--allow-net`, `--allow-net=api.example.com` |
| `--allow-env` | Environment variables | `--allow-env`, `--allow-env=API_KEY,DATABASE_URL` |
| `--allow-sys` | System information | `--allow-sys` |
| `--allow-ffi` | Foreign Function Interface | `--allow-ffi` |
| `--allow-run` | Subprocess execution | `--allow-run` |

## Security Best Practices

1. **Use scoped permissions** - Limit access to specific paths or hosts:
   ```yaml
   permissions:
     - --allow-read=/data
     - --allow-net=api.example.com
   ```

2. **Validate tool inputs** - Always check parameters in your tool functions:
   ```typescript
   export async function processFile(params: { filename: string }) {
     if (!params.filename || typeof params.filename !== 'string') {
       throw new Error('Invalid filename parameter');
     }
     // Tool implementation
   }
   ```

3. **Use environment variables for secrets** - Never hardcode API keys:
   ```typescript
   export async function callAPI() {
     const apiKey = process.env.API_KEY;
     if (!apiKey) throw new Error('API_KEY not configured');
     // Use apiKey safely
   }
   ```

## Defaults

If you don't specify runtime configuration, Compozy uses these defaults:

```yaml
runtime:
  type: bun
  entrypoint: "./tools.ts"
  permissions:
    - --allow-read
```

<Callout type="info">
The default configuration only allows reading files for security. Add additional permissions as needed for your tools.
</Callout>

## References

<ReferenceCardList>
<ReferenceCard
  title="Tool Development"
  description="Learn how to build and test tools for the runtime"
  href="/docs/core/tools/typescript-development"
  icon="Code"
/>
<ReferenceCard
  title="Security Best Practices"
  description="Comprehensive security guidelines for production"
  href="/docs/core/tools/performance-security"
  icon="Shield"
/>
<ReferenceCard
  title="Project Configuration"
  description="Complete project setup and configuration guide"
  href="/docs/core/configuration/project-setup"
  icon="Settings"
/>
<ReferenceCard
  title="Testing & Debugging"
  description="Tools and techniques for debugging runtime issues"
  href="/docs/core/tools/testing-debugging"
  icon="Bug"
/>
</ReferenceCardList>
