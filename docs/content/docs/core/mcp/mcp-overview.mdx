---
title: "MCP Overview"
description: "Understanding Model Context Protocol (MCP) integration in Compozy"
---

Model Context Protocol (MCP) is a standardized protocol that enables AI agents to interact with external tools, services, and data sources through a unified interface. It bridges the gap between language models and the external world, providing a consistent way for agents to extend their capabilities beyond their core language model functionality.

<Callout type="info">
**MCP in Compozy**: The MCP system acts as a universal adapter, allowing your AI agents to seamlessly integrate with external tools, APIs, and services without custom integration code.
</Callout>

## Quick Navigation

<ReferenceCardList cols={3}>
  <ReferenceCard
    title="MCP Proxy Server"
    href="/docs/core/mcp/mcp-proxy-server"
    description="Central gateway architecture"
    icon="Radio"
  />
  <ReferenceCard
    title="Transport Configuration"
    href="/docs/core/mcp/transport-configuration"
    description="Communication protocols"
    icon="Link2"
  />
  <ReferenceCard
    title="Security & Authentication"
    href="/docs/core/mcp/security-authentication"
    description="Secure your MCP setup"
    icon="Shield"
  />
</ReferenceCardList>

## What is MCP?

MCP is a protocol that allows AI agents to:

<FeatureCardList cols={2}>
  <FeatureCard
    title="File System Access"
    description="Read, write, and manipulate files and directories"
    icon="FileCode"
  />
  <FeatureCard
    title="Database Operations"
    description="Query and modify databases with SQL and NoSQL support"
    icon="Database"
  />
  <FeatureCard
    title="API Integration"
    description="Interact with external REST APIs and web services"
    icon="Globe"
  />
  <FeatureCard
    title="Code Execution"
    description="Run Python, JavaScript, and other code runtimes"
    icon="Cpu"
  />
</FeatureCardList>

## Architecture Overview

<Mermaid>
{`
graph TB
    subgraph "AI Agent Layer"
        A[AI Agent]
        A1[Workflow Engine]
        A2[Task Executor]
    end

    subgraph "MCP Proxy Service - Port 8081"
        B[HTTP Router]
        B1[Admin API]
        B2[Connection Manager]
        B3[Transport Layer]
        B4[Auth Manager]
        B5[Storage Backend]
    end

    subgraph "MCP Servers"
        C[stdio Server]
        D[SSE Server]
        E[HTTP Server]
        F[Docker Server]
    end

    subgraph "External Services"
        G[Database]
        H[File System]
        I[APIs]
        J[Code Runtime]
    end

    A --> B
    A1 --> B
    A2 --> B

    B --> B1
    B --> B2
    B --> B3
    B --> B4
    B --> B5

    B2 --> C
    B2 --> D
    B2 --> E
    B2 --> F

    C --> G
    D --> H
    E --> I
    F --> J

    style A fill:#e1f5fe
    style B fill:#f3e5f5
    style C fill:#e8f5e8
    style D fill:#e8f5e8
    style E fill:#e8f5e8
    style F fill:#e8f5e8
    style G fill:#fff3e0
    style H fill:#fff3e0
    style I fill:#fff3e0
    style J fill:#fff3e0
`}
</Mermaid>

<Callout type="info">
**Proxy Architecture**: The MCP proxy runs on port 8081 and manages all server connections, providing a unified HTTP interface for multiple transport types.
</Callout>

### Key Components

<AccordionGroup>
<Accordion title="MCP Proxy" icon="Radio">
Central gateway that manages all MCP server connections, handles routing, authentication, and provides a unified HTTP interface for multiple MCP servers.

**Features:**
- Multi-transport support (stdio, SSE, HTTP)
- Dynamic server registration
- Connection pooling and health monitoring
- Token-based authentication
</Accordion>

<Accordion title="MCP Servers" icon="Package">
External services that provide tools and capabilities to AI agents. These can be local processes, Docker containers, or remote HTTP services.

**Types:**
- Local process servers (stdio)
- Remote HTTP servers (SSE)
- Streaming HTTP servers (streamable-http)
- Docker-based servers
</Accordion>

<Accordion title="AI Agents" icon="BrainCircuit">
Your AI applications that use MCP tools to extend their capabilities. Agents configure MCP servers and use them through the proxy.

**Capabilities:**
- Tool discovery and selection
- Context-aware tool usage
- Error handling and retries
- Resource management
</Accordion>

<Accordion title="Transport Layer" icon="Link2">
Communication protocols that enable different types of MCP server connections based on your needs.

**Protocols:**
- **stdio**: Standard I/O for local processes
- **sse**: Server-Sent Events for real-time HTTP streaming
- **streamable-http**: HTTP with streaming for large responses
</Accordion>
</AccordionGroup>

## MCP Server Types

<Tabs defaultValue="remote" items={["remote", "local", "docker"]}>
<Tab value="remote">
**Remote MCP Servers (HTTP/HTTPS)**

Remote servers accessed via network endpoints using Server-Sent Events (SSE) or HTTP streaming:

```yaml title="Weather API Server"
mcps:
  - id: weather-api
    url: "https://api.weather-mcp.com/v1"
    transport: sse
    headers:
      Authorization: "Bearer {{ .env.WEATHER_API_KEY }}"
    timeout: 30s
    auto_reconnect: true
```

<Callout type="info">
**Best For**: Third-party APIs, cloud services, real-time data feeds
</Callout>
</Tab>

<Tab value="local">
**Local Process Servers (stdio)**

Child processes spawned locally, communicating via standard I/O:

```yaml title="Filesystem Server"
mcps:
  - id: filesystem
    command: "mcp-server-filesystem"
    args: ["--root", "/data"]
    transport: stdio
    env:
      LOG_LEVEL: "debug"
      MAX_FILE_SIZE: "10MB"
```

<Callout type="info">
**Best For**: Local file operations, command-line tools, high-performance local communication
</Callout>
</Tab>

<Tab value="docker">
**Docker-based Servers**

Run MCP servers in containers with environment configuration:

```yaml title="Database Server"
mcps:
  - id: database
    command: "docker run --rm -i mcp-postgres:latest"
    transport: stdio
    env:
      DATABASE_URL: "postgres://user:pass@db/myapp"
      POOL_SIZE: "10"
    start_timeout: 30s
```

<Callout type="info">
**Best For**: Isolated environments, complex dependencies, microservices architecture
</Callout>
</Tab>
</Tabs>

## Transport Types Comparison

<Table>
<TableHeader>
  <TableRow>
    <TableHead>Transport</TableHead>
    <TableHead>Description</TableHead>
    <TableHead>Use Case</TableHead>
    <TableHead>Performance</TableHead>
  </TableRow>
</TableHeader>
<TableBody>
  <TableRow>
    <TableCell className="font-mono">sse</TableCell>
    <TableCell>Server-Sent Events</TableCell>
    <TableCell>Real-time streaming from HTTP servers</TableCell>
    <TableCell>Medium latency, good for real-time</TableCell>
  </TableRow>
  <TableRow>
    <TableCell className="font-mono">streamable-http</TableCell>
    <TableCell>HTTP with streaming</TableCell>
    <TableCell>Large responses, file transfers</TableCell>
    <TableCell>High throughput, handles large data</TableCell>
  </TableRow>
  <TableRow>
    <TableCell className="font-mono">stdio</TableCell>
    <TableCell>Standard I/O</TableCell>
    <TableCell>Local processes, Docker containers</TableCell>
    <TableCell>Low latency, high performance</TableCell>
  </TableRow>
</TableBody>
</Table>

## Key Features

<FeatureCardList cols={2}>
  <FeatureCard
    title="Dynamic Registration"
    description="Hot-add, update, or remove servers via Admin API with zero downtime"
    icon="RefreshCw"
  />
  <FeatureCard
    title="Security & Authentication"
    description="Token-based auth, IP allow-lists, and environment variable management"
    icon="Shield"
  />
  <FeatureCard
    title="Observability & Monitoring"
    description="Health checks, metrics tracking, and comprehensive logging"
    icon="BarChart3"
  />
  <FeatureCard
    title="Tool Discovery"
    description="Automatic discovery and aggregation across multiple servers"
    icon="Eye"
  />
</FeatureCardList>

## Environment Requirements

<Callout type="warning">
**Required Configuration**: The MCP system requires these environment variables to function properly.
</Callout>

```bash title="Environment Variables"
# Required: MCP proxy service URL
MCP_PROXY_URL=http://localhost:8081

# Optional: Admin token for proxy management
MCP_PROXY_ADMIN_TOKEN=your-admin-token

# Optional: Global authentication token
MCP_PROXY_GLOBAL_AUTH_TOKEN=global-token
```

## Quick Start with CLI

Get started with MCP in Compozy using the CLI:

```bash
# 1. Initialize a new project
compozy init my-mcp-project
cd my-mcp-project

# 2. Start the development environment
compozy dev --watch

# 3. In another terminal, start the MCP proxy
compozy mcp-proxy --port 8081 --debug

# 4. Create a simple workflow
cat > workflow.yaml << 'EOF'
resource: workflow
id: data-analyst
description: "Analyze data using available tools"

mcps:
  - id: filesystem
    transport: stdio
    command: "mcp-server-filesystem"
    args: ["--root", "/workspace"]
    env:
      LOG_LEVEL: "info"

agents:
  - id: analyst
    instructions: "You can analyze data using filesystem tools"

tasks:
  - id: analyze
    type: basic
    agent: analyst
    prompt: "List and analyze the files in the workspace"
EOF

# 5. Execute the workflow
compozy workflow execute data-analyst
```

<Steps>
<Step title="Initialize Project">
Use `compozy init` to create a new project with MCP support and default configurations.
</Step>
<Step title="Start Development Server">
Run `compozy dev --watch` to start the development server with hot reload capabilities.
</Step>
<Step title="Start MCP Proxy">
Launch `compozy mcp-proxy` to handle all MCP server connections and routing.
</Step>
<Step title="Test Integration">
Use `compozy workflow execute` to verify that your workflows can use MCP tools.
</Step>
</Steps>

## Integration with Compozy Workflow System

MCP seamlessly integrates with Compozy's workflow orchestration through a unified architecture:

<Mermaid>
{`
sequenceDiagram
    participant Agent as AI Agent
    participant Client as MCP Client
    participant Proxy as MCP Proxy (8081)
    participant Server as MCP Server
    participant Service as External Service

    Agent->>Client: Request Tool Use
    Client->>Proxy: HTTP Request
    Proxy->>Server: Transport Call
    Server->>Service: Service Operation
    Service-->>Server: Response
    Server-->>Proxy: MCP Response
    Proxy-->>Client: HTTP Response
    Client-->>Agent: Tool Result

    Note over Agent,Service: Fault-tolerant with automatic retries
    Note over Proxy: Handles authentication & connection pooling
    Note over Server: Supports stdio, SSE, and HTTP transports
`}
</Mermaid>

### Integration Points

<AccordionGroup>
<Accordion title="Agent Configuration" icon="Users">
**YAML Configuration Integration**

MCP servers are defined directly in agent configuration files:

```yaml
resource: workflow
id: data-analyst
description: "Analyze data using available tools"

mcps:
  - id: sql-server
    url: "http://mcp-proxy:8081/sql"
    transport: sse
    headers:
      Authorization: "Bearer {{ .env.SQL_TOKEN }}"
    timeout: 30s

  - id: python-runtime
    command: "mcp-python-server"
    transport: stdio
    env:
      PYTHONPATH: "/app/libs"
      LOG_LEVEL: "info"
    start_timeout: 30s

agents:
  - id: analyst
    instructions: "Analyze data using available tools"

tasks:
  - id: analysis
    type: basic
    agent: analyst
    prompt: "Query the sales database and create a visualization"
```

**Key Features:**
- Template engine support for environment variables
- Transport-specific configuration options
- Automatic service discovery and registration
- Health monitoring and failover
</Accordion>

<Accordion title="Tool Discovery" icon="Search">
**Automatic Tool Registration**

MCP servers automatically expose their available tools through the proxy:

```yaml
# Available tools are discovered automatically
# No manual tool registration required

actions:
  - id: analyze_data
    prompt: "Query the sales database and create a visualization"
    tools: ["sql-query", "python-plot"]  # Auto-discovered
```

**Discovery Process:**
1. Agent connects to MCP proxy
2. Proxy queries all registered servers
3. Tools are aggregated and made available
4. Agent can use any discovered tool
5. Tool schemas are validated automatically
</Accordion>

<Accordion title="Workflow Integration" icon="Workflow">
**Task-Level Integration**

MCP tools integrate seamlessly with Compozy's task system:

```yaml
tasks:
  - id: data_analysis
    type: basic
    $use: agent(local::agents.#(id=="data-analyst"))
    action: analyze_data
    inputs:
      query: "SELECT * FROM sales WHERE date > '2024-01-01'"
      chart_type: "bar"
    final: true
```

**Integration Benefits:**
- Unified error handling across all tools
- Automatic retry logic for failed operations
- Resource cleanup and connection management
- Comprehensive logging and monitoring
</Accordion>

<Accordion title="Error Handling" icon="CalloutCircle">
**Robust Error Recovery**

MCP integration includes comprehensive error handling:

```yaml
mcps:
  - id: reliable-service
    transport: sse
    url: "https://api.example.com/mcp"
    auto_reconnect: true
    max_reconnects: 10
    reconnect_delay: 5s
    health_check_enabled: true
    health_check_interval: 30s
```

**Error Recovery Features:**
- Automatic connection recovery
- Exponential backoff for retries
- Circuit breaker pattern for failing services
- Graceful degradation on repeated failures
- Health check monitoring
</Accordion>

<Accordion title="Resource Management" icon="Gauge">
**Efficient Resource Utilization**

MCP system manages resources efficiently:

```yaml
mcps:
  - id: resource-managed
    transport: stdio
    command: "mcp-server"
    max_sessions: 10
    start_timeout: 30s
    env:
      MAX_MEMORY: "512M"
      MAX_CPU: "1.0"
```

**Resource Features:**
- Connection pooling and reuse
- Session limits to prevent overload
- Automatic process lifecycle management
- Memory and CPU limits for processes
- Cleanup on agent shutdown
</Accordion>
</AccordionGroup>

## Integration with Compozy Components

<FeatureCardList cols={2}>
  <FeatureCard
    title="Agent Configuration"
    href="/docs/core/agents/overview"
    icon="Users"
  >
    Configure MCP servers in your AI agents for extended capabilities
  </FeatureCard>
  <FeatureCard
    title="Task Integration"
    href="/docs/core/tasks/basic-tasks"
    icon="GitBranch"
  >
    Use MCP tools within workflow tasks for external service integration
  </FeatureCard>
  <FeatureCard
    title="Tool Development"
    href="/docs/core/tools/tools-overview"
    icon="Code"
  >
    Learn how MCP complements TypeScript tool development
  </FeatureCard>
  <FeatureCard
    title="Configuration Setup"
    href="/docs/core/configuration/providers"
    icon="Settings"
  >
    Set up MCP providers in your project configuration
  </FeatureCard>
</FeatureCardList>

## Technical Deep Dive

<FeatureCardList cols={2}>
  <FeatureCard
    title="MCP Proxy Server"
    href="/docs/core/mcp/mcp-proxy-server"
    icon="Radio"
  >
    Learn about the proxy architecture and management
  </FeatureCard>
  <FeatureCard
    title="Transport Configuration"
    href="/docs/core/mcp/transport-configuration"
    icon="Link2"
  >
    Configure different transport types and protocols
  </FeatureCard>
  <FeatureCard
    title="Security & Authentication"
    href="/docs/core/mcp/security-authentication"
    icon="Shield"
  >
    Secure your MCP setup with proper authentication
  </FeatureCard>
  <FeatureCard
    title="Tool Discovery"
    href="/docs/core/mcp/tool-discovery"
    icon="Eye"
  >
    Understand automatic tool discovery mechanisms
  </FeatureCard>
</FeatureCardList>

## User Journey Navigation

<Tabs defaultValue="beginner" items={["beginner", "intermediate", "advanced"]}>
<Tab value="beginner">
**For Beginners - Getting Started with MCP**

<ReferenceCardList>
  <ReferenceCard
    title="CLI Quick Start"
    description="Use `compozy init` and `compozy dev` to get started in minutes"
    href="/docs/core/getting-started/quick-start"
    icon="Terminal"
  />
  <ReferenceCard
    title="Development Commands"
    description="Learn essential CLI commands for MCP development"
    href="/docs/core/mcp/development-debugging"
    icon="Code"
  />
  <ReferenceCard
    title="First Workflow Tutorial"
    description="Step-by-step guide to creating MCP-powered workflows"
    href="/docs/core/getting-started/first-workflow"
    icon="PlayCircle"
  />
  <ReferenceCard
    title="Agent Basics"
    description="Learn agent configuration before MCP integration"
    href="/docs/core/agents/overview"
    icon="BrainCircuit"
  />
</ReferenceCardList>

<Callout type="info">
**Recommended Path**: Start with `compozy init` to create a project, use `compozy dev --watch` for development, and `compozy mcp-proxy` for testing. Progress from stdio MCP servers for local development to remote HTTP servers for production.
</Callout>

**Learning Goals:**
- ✅ Master Compozy CLI commands for MCP development
- ✅ Understand MCP architecture and benefits
- ✅ Configure your first MCP server
- ✅ Create agents that use MCP tools
- ✅ Test MCP integration locally
</Tab>

<Tab value="intermediate">
**For Intermediate Users - Production Patterns**

<ReferenceCardList>
  <ReferenceCard
    title="Transport Configuration"
    description="Master stdio, SSE, and HTTP transport protocols"
    href="/docs/core/mcp/transport-configuration"
    icon="Network"
  />
  <ReferenceCard
    title="Security & Authentication"
    description="Secure your MCP deployments with proper authentication"
    href="/docs/core/mcp/security-authentication"
    icon="Shield"
  />
  <ReferenceCard
    title="Production Deployment"
    description="Scale MCP systems with Docker and Kubernetes"
    href="/docs/core/mcp/production-deployment"
    icon="Server"
  />
  <ReferenceCard
    title="Monitoring & Metrics"
    description="Implement comprehensive MCP observability"
    href="/docs/core/mcp/monitoring-metrics"
    icon="BarChart3"
  />
</ReferenceCardList>

<Callout type="info">
**Production Focus**: Implement proper error handling, retry logic, and health monitoring for reliable MCP operations.
</Callout>

**Learning Goals:**
- ✅ Configure production-ready MCP servers
- ✅ Implement security best practices
- ✅ Monitor MCP system health
- ✅ Scale MCP deployments effectively
</Tab>

<Tab value="advanced">
**For Advanced Users - Custom MCP Development**

<ReferenceCardList>
  <ReferenceCard
    title="Custom MCP Servers"
    description="Build specialized MCP servers for domain-specific needs"
    href="/docs/core/examples/advanced-examples"
    icon="Code"
  />
  <ReferenceCard
    title="Development & Debugging"
    description="Advanced debugging techniques and development workflows"
    href="/docs/core/mcp/development-debugging"
    icon="Bug"
  />
  <ReferenceCard
    title="Storage Backends"
    description="Extend MCP with custom storage solutions"
    href="/docs/core/mcp/storage-backends"
    icon="Database"
  />
  <ReferenceCard
    title="Performance Optimization"
    description="Optimize MCP performance for high-throughput scenarios"
    href="/docs/core/mcp/performance-optimization"
    icon="Zap"
  />
</ReferenceCardList>

<Callout type="info">
**Advanced Patterns**: Create custom MCP servers for specialized tooling, implement custom storage backends, and optimize for specific use cases.
</Callout>

**Learning Goals:**
- ✅ Develop custom MCP server implementations
- ✅ Optimize MCP performance for specific workloads
- ✅ Extend MCP with custom storage solutions
- ✅ Contribute to the MCP ecosystem
</Tab>
</Tabs>

## CLI Command Reference

### Essential MCP Commands

```bash
# Project initialization
compozy init [project-name]              # Create new MCP-enabled project

# Development server
compozy dev [--watch]                    # Start dev server with hot reload
compozy start                            # Start production server

# MCP proxy management
compozy mcp-proxy [--port 8081]          # Start MCP proxy service
compozy mcp-proxy health                 # Check proxy health
compozy mcp-proxy list                   # List registered MCP servers

# Workflow management
compozy workflow list                    # List all workflows
compozy workflow get [id]                # Get workflow details
compozy workflow execute [id]            # Execute workflow

# Configuration
compozy config [subcommand]              # Manage configuration

# Authentication
compozy auth generate                    # Generate API keys
compozy auth list                        # List API keys
```

## Benefits

<FeatureCardList cols={3}>
  <FeatureCard
    title="CLI-First Development"
    description="Complete CLI toolkit for MCP development and deployment"
    icon="Terminal"
  />
  <FeatureCard
    title="Standardization"
    description="Unified interface for tool integration across all services"
    icon="Layers"
  />
  <FeatureCard
    title="Extensibility"
    description="Easy to add new tools and services without code changes"
    icon="Package"
  />
  <FeatureCard
    title="Reliability"
    description="Built-in retry logic and error handling for robust operation"
    icon="ShieldCheck"
  />
  <FeatureCard
    title="Performance"
    description="Efficient connection pooling and caching for optimal speed"
    icon="Zap"
  />
  <FeatureCard
    title="Security"
    description="Comprehensive authentication and authorization mechanisms"
    icon="Lock"
  />
</FeatureCardList>
