---
title: "Development & Debugging"
description: "Tools, techniques, and best practices for developing and debugging MCP integrations in Compozy"
---

This guide provides comprehensive tools and techniques for developing and debugging MCP (Model Context Protocol) integrations in Compozy. Whether you're building custom MCP servers or troubleshooting existing integrations, this guide will help you identify and resolve issues quickly.

<Callout type="info" icon="Code">
  **MCP Development**: Understanding the MCP protocol and Compozy's implementation is key to successful debugging and development.
</Callout>

## Understanding MCP Architecture

MCP (Model Context Protocol) in Compozy follows a simple but effective architecture:

### Core Components

<FeatureCardList cols={2} size="sm">
  <FeatureCard
    title="MCP Client"
    description="HTTP client that communicates with the MCP proxy service"
    icon="Network"
  />
  <FeatureCard
    title="MCP Proxy"
    description="HTTP proxy service that manages MCP server connections"
    icon="Router"
  />
  <FeatureCard
    title="MCP Server"
    description="External servers that provide tools and capabilities"
    icon="Server"
  />
  <FeatureCard
    title="Registration Service"
    description="Service that manages MCP server lifecycle"
    icon="Settings"
  />
</FeatureCardList>

## Development Setup

### Prerequisites

Before developing MCP integrations, ensure you have:

- **Compozy CLI**: Installed and available in your PATH
- **MCP Proxy Service**: Running on the configured port (default: 8081)
- **Environment Variables**: `MCP_PROXY_URL` and optionally `MCP_PROXY_ADMIN_TOKEN`
- **Logging**: Enable debug logging for detailed information

### Quick Start with CLI

Compozy provides a comprehensive CLI for managing your development workflow:

```bash
# Initialize a new Compozy project
compozy init my-project

# Start the development server with hot reload
compozy dev --watch

# Start the MCP proxy service
compozy mcp-proxy --port 8081

# List available workflows
compozy workflow list

# Execute a workflow
compozy workflow execute my-workflow
```

### Environment Configuration

Configure your development environment with proper logging and debugging settings:

```bash title=".env.development"
# MCP Proxy Configuration
MCP_PROXY_URL=http://localhost:8081
MCP_PROXY_ADMIN_TOKEN=your-admin-token

# Logging Configuration
LOG_LEVEL=debug
COMPOZY_LOG_LEVEL=debug
```

**Why these settings matter:**
- `MCP_PROXY_URL`: Points to your local MCP proxy service
- `MCP_PROXY_ADMIN_TOKEN`: Enables admin API access for debugging
- `LOG_LEVEL=debug`: Provides detailed logging for troubleshooting

## Common Development Patterns

### 1. MCP Server Registration

The most common task is registering MCP servers with your workflows:

```yaml title="workflow.yaml"
resource: workflow
id: mcp-example
description: Example workflow with MCP integration

mcps:
  - id: filesystem
    transport: stdio
    command: "mcp-server-filesystem"
    args: ["--root", "/workspace"]
    env:
      LOG_LEVEL: debug

agents:
  - id: file-agent
    instructions: "You can access the filesystem using available tools"

tasks:
  - id: list-files
    agent: file-agent
    prompt: "List all files in the current directory"
```

**Key Points:**
- Use `transport: stdio` for local MCP servers
- Use `transport: sse` for HTTP-based MCP servers
- Always include debugging environment variables during development

### 2. Tool Discovery and Testing

Test MCP tool discovery to ensure your servers are properly registered:

```go title="debug_tools.go"
package main

import (
    "context"
    "fmt"
    "log"
    "time"

    "github.com/compozy/compozy/engine/mcp"
)

func main() {
    client := mcp.NewProxyClient("http://localhost:8081", "admin-token", 30*time.Second)

    // Test health check
    if err := client.Health(context.Background()); err != nil {
        log.Fatalf("MCP proxy health check failed: %v", err)
    }

    // List available tools
    tools, err := client.ListTools(context.Background())
    if err != nil {
        log.Fatalf("Failed to list tools: %v", err)
    }

    fmt.Printf("Available tools: %d\n", len(tools))
    for _, tool := range tools {
        fmt.Printf("- %s (%s): %s\n", tool.Name, tool.MCPName, tool.Description)
    }
}
```

**This pattern helps you:**
- Verify MCP proxy connectivity
- Discover available tools from registered servers
- Test tool registration and discovery flow

**Note**: The error handling shown uses the actual `ProxyRequestError` struct from the implementation, which provides structured error information including status codes and detailed messages.

## Debugging Common Issues

### 1. MCP Server Registration Failures

**Problem**: MCP servers fail to register with the proxy.

**Debugging Steps:**

1. **Check Proxy Health**:
```bash
# Using CLI (recommended)
compozy mcp-proxy health

# Or using curl directly
curl -X GET http://localhost:8081/healthz
```

2. **Verify Registration**:
```bash
# Using CLI (recommended)
compozy mcp-proxy list

# Or using curl directly
curl -X GET http://localhost:8081/admin/mcps \
  -H "Authorization: Bearer your-admin-token"
```

3. **Check Logs**:
```bash
# In your application logs, look for:
# - "Successfully registered MCP with proxy"
# - "Failed to register MCP with proxy"
# - Connection timeout errors
```

**Common Causes:**
- MCP proxy service not running
- Incorrect proxy URL configuration
- Missing or invalid admin token
- Network connectivity issues

### 2. Tool Execution Errors

**Problem**: Tools fail to execute or return errors.

**Debugging Steps:**

1. **Test Tool Directly**:
```bash
# Using CLI (recommended)
compozy workflow execute test-tool --input '{"mcpName": "filesystem", "toolName": "list_files", "arguments": {"path": "/workspace"}}'

# Or using curl directly
curl -X POST http://localhost:8081/admin/tools/call \
  -H "Authorization: Bearer your-admin-token" \
  -H "Content-Type: application/json" \
  -d '{
    "mcpName": "filesystem",
    "toolName": "list_files",
    "arguments": {"path": "/workspace"}
  }'
```

2. **Check MCP Server Logs**:
```bash
# Look for tool execution logs in your MCP server
# Common patterns:
# - "Tool executed successfully"
# - "Tool execution failed"
# - Argument validation errors
```

3. **Verify Tool Schema**:
```go
// Check tool input schema matches your arguments
tools, err := client.ListTools(context.Background())
for _, tool := range tools {
    if tool.Name == "your-tool-name" {
        fmt.Printf("Input schema: %+v\n", tool.InputSchema)
    }
}
```

## Troubleshooting Guide

### Quick Diagnostic Checklist

1. **✅ MCP Proxy Health**: `curl http://localhost:8081/healthz`
2. **✅ MCP Registration**: Check admin API for registered servers
3. **✅ Tool Discovery**: Verify tools are discoverable
4. **✅ Network Connectivity**: Test port accessibility
5. **✅ Logging**: Enable debug logging for detailed information
6. **✅ Environment**: Verify all required environment variables

### Common Error Messages

| Error Message | Cause | Solution |
|---------------|-------|----------|
| `connection refused` | MCP proxy not running | Start MCP proxy service |
| `unauthorized: invalid admin token` | Wrong admin token | Check `MCP_PROXY_ADMIN_TOKEN` |
| `MCP not found` | Server not registered | Register MCP server first |
| `tool execution error` | Invalid arguments | Check tool schema |
| `context deadline exceeded` | Timeout | Increase timeout configuration |

## Best Practices

### 1. Development Environment

- Always use debug logging during development
- Set appropriate timeouts for your MCP servers
- Use environment-specific configuration
- Implement proper error handling

### 2. Testing

- Write unit tests for MCP integrations
- Test both success and failure scenarios
- Use integration tests for end-to-end validation
- Mock external dependencies when appropriate

### 3. Production Considerations

- Use appropriate log levels (info/warn/error)
- Monitor MCP server health and performance
- Implement circuit breakers for resilience
- Use proper authentication tokens

## CLI Command Reference

### Core Development Commands

```bash
# Project Management
compozy init [project-name]          # Initialize new project
compozy dev [--watch]                # Development server with hot reload
compozy start                        # Production server
compozy config [subcommand]          # Configuration management

# MCP Proxy Management
compozy mcp-proxy [subcommand]       # MCP proxy service management

# Workflow Management
compozy workflow list                # List available workflows
compozy workflow get [workflow-id]   # Get workflow details
compozy workflow execute [workflow]  # Execute workflow

# Authentication
compozy auth generate                # Generate API keys
compozy auth list                    # List API keys
compozy auth revoke [key-id]         # Revoke API key
compozy auth create-user             # Create user
compozy auth list-users              # List users
```

### Global Flags

All commands support these global flags:
- `--json`: Output in JSON format
- `--quiet`: Suppress non-essential output
- `--debug`: Enable debug logging
- `--config`: Specify config file path
- `--env-file`: Specify environment file path

## Additional Resources

For more information about MCP development:

- [MCP Overview](/docs/core/mcp/mcp-overview) - Understanding MCP fundamentals
- [Integration Patterns](/docs/core/mcp/integration-patterns) - Common integration approaches
- [Client Manager](/docs/core/mcp/client-manager) - Client lifecycle management
- [Production Deployment](/docs/core/mcp/production-deployment) - Production best practices

<Callout type="info" icon="Lightbulb">
  **Pro Tip**: Start with simple MCP integrations and gradually add complexity. Use debug logging extensively during development to understand the flow of operations.
</Callout>
