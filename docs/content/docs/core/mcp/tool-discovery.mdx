---
title: "Tool Discovery"
description: "Simple tool discovery from MCP servers via HTTP proxy endpoints"
---

Tool Discovery in Compozy is a simple mechanism for discovering and accessing tools from registered MCP servers through the MCP proxy. The system provides basic caching and tool enumeration capabilities.

<Callout type="info">
  <Icon name="search" className="w-4 h-4" />
  **Automatic Discovery**: Tools are discovered automatically from registered MCP servers through HTTP requests to the proxy service.
</Callout>

## How Tool Discovery Works

The tool discovery process is straightforward:

1. **MCP Server Registration**: MCP servers are registered with the proxy
2. **Tool Enumeration**: The proxy queries each registered server for available tools
3. **Tool Caching**: Tools are cached in memory for 5 minutes to reduce latency
4. **API Access**: Applications can query available tools through the `/admin/tools` endpoint

## Basic Discovery Flow

```yaml
# Example MCP server registration
mcps:
  - name: filesystem_server
    transport: stdio
    command: npx
    args: ["-y", "@modelcontextprotocol/server-filesystem", "./workspace"]
```

When an MCP server is registered, the proxy can discover its tools through the MCP protocol.

## Tool Registry Implementation

The tool registry provides a simple interface for managing discovered tools:

```go
// ToolRegistry manages tool discovery and caching
type ToolRegistry interface {
    Register(ctx context.Context, tool Tool) error
    Find(ctx context.Context, name string) (Tool, bool)
    ListAll(ctx context.Context) ([]Tool, error)
    InvalidateCache(ctx context.Context)
    Close() error
}
```

**Key Features:**
- **Local Tool Priority**: Local tools take precedence over MCP tools
- **Simple Caching**: 5-minute TTL cache for MCP tools
- **Basic Registry**: In-memory storage of discovered tools
- **HTTP Client**: Simple HTTP requests to proxy endpoints

## API Endpoints

### List All Tools

Get all available tools from registered MCP servers:

```http
GET /admin/tools
Authorization: Bearer <admin-token>
```

**Response:**
```json
{
  "tools": [
    {
      "name": "read_file",
      "description": "Read contents of a file",
      "inputSchema": {
        "type": "object",
        "properties": {
          "path": {"type": "string"}
        }
      },
      "mcpName": "filesystem_server"
    }
  ],
  "count": 1
}
```

### Tool Execution

Execute a tool on a specific MCP server:

```http
POST /admin/tools/call
Authorization: Bearer <admin-token>
Content-Type: application/json

{
  "mcpName": "filesystem_server",
  "toolName": "read_file",
  "arguments": {
    "path": "/path/to/file.txt"
  }
}
```

**Tool Execution**: The MCP proxy supports full tool execution via the `/admin/tools/call` endpoint with comprehensive error handling and result processing.

**Response Format**:
```json
{
  "result": {
    "type": "text",
    "text": "File contents here..."
  }
}
```

**Error Handling**: The system provides detailed error responses for various failure scenarios:
- MCP server not connected: HTTP 404
- Invalid tool parameters: HTTP 400  
- Tool execution failure: HTTP 500 with error details

## Configuration

Tool discovery is configured through MCP server registration:

```yaml
# compozy.yaml
mcps:
  - name: my_server
    transport: stdio
    command: my-mcp-server
    args: ["--config", "config.json"]
```

## Caching Behavior

**Cache Duration**: 5 minutes by default (configurable via `ToolRegistryConfig.CacheTTL`)

**Cache Invalidation**: 
- Automatic expiration after TTL
- Manual invalidation via `InvalidateCache()`
- Cache refresh on next tool access

**Cache Strategy**:
- Single-flight pattern prevents thundering herd
- Thread-safe read/write operations
- Simple timestamp-based TTL checking

## Error Handling

The tool discovery system handles common errors:

- **Connection Errors**: Proxy unavailable or MCP server disconnected
- **Tool Not Found**: Requested tool doesn't exist
- **Execution Errors**: Failures during tool execution on the target MCP server, which are propagated with detailed error messages

## Implementation Overview

The tool registry provides a unified interface for managing tools:

- **Local tools** take priority over MCP tools with the same name
- **MCP tools** are fetched from the proxy and cached for 5 minutes by default
- **Thread-safe operations** ensure concurrent access safety
- **Tool execution** is handled through the MCP service layer

## Limitations

- **Basic Caching**: Simple TTL-based caching without persistence
- **No Filtering**: Tools are returned without categorization or filtering
- **No Metrics**: No performance monitoring or discovery metrics
- **No Complex Discovery**: No multi-stage pipelines or quality gates

## Next Steps

For tool discovery improvements, consider:

1. **Add Filtering**: Support for tool categorization and filtering
2. **Improve Caching**: Persistent caching with Redis backend
3. **Add Metrics**: Basic discovery and execution metrics
4. **Error Recovery**: Better handling of MCP server failures

## Related Documentation

<ReferenceCardList>
  <ReferenceCard
    title="MCP Overview"
    description="Understanding the MCP protocol"
    href="/docs/core/mcp/mcp-overview"
    icon="BookOpen"
  />
  <ReferenceCard
    title="Storage Backends"
    description="How MCP data is stored"
    href="/docs/core/mcp/storage-backends"
    icon="Database"
  />
  <ReferenceCard
    title="Transport Configuration"
    description="MCP transport setup"
    href="/docs/core/mcp/transport-configuration"
    icon="Network"
  />
</ReferenceCardList>