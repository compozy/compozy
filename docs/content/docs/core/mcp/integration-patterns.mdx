---
title: "Integration Patterns"
description: MCP (Model Context Protocol) integration patterns provide proven approaches for connecting external tools and services with Compozy agents and workflows. This guide covers common patterns, best practices, and implementation strategies for building robust MCP integrations using Compozy's simple HTTP-based architecture.
---

## Overview

<FeatureCardList cols={2} size="default">
  <FeatureCard
    title="Agent Integration"
    description="Connect AI agents directly to MCP servers for intelligent tool usage"
    icon="BrainCircuit"
  />
  <FeatureCard
    title="Workflow Integration"
    description="Use MCP servers within workflow task orchestration"
    icon="Workflow"
  />
  <FeatureCard
    title="Multi-Server Configuration"
    description="Configure multiple MCP servers for different capabilities"
    icon="Users"
  />
  <FeatureCard
    title="External Tool Integration"
    description="Connect external tools through MCP protocol adapters"
    icon="Link2"
  />
</FeatureCardList>

## Agent Integration Patterns

### Single MCP Server Integration

The simplest integration pattern connects one agent to one MCP server for focused functionality:

```yaml title="workflow-with-mcp.yaml"
resource: workflow
id: file-management-workflow
description: Workflow using MCP filesystem server

# MCP server configuration
mcps:
  - id: filesystem
    transport: stdio
    command: "mcp-server-filesystem"
    args: ["--root", "/workspace"]
    env:
      LOG_LEVEL: "info"

agents:
  - id: file_manager
    instructions: |
      You are a file management assistant with access to the file system.
      You can read, write, and organize files in the workspace directory.
      Always confirm destructive operations before executing them.

tasks:
  - id: list_workspace_files
    type: basic
    agent: file_manager
    prompt: "List all files in the workspace directory"

  - id: read_specific_file
    type: basic
    agent: file_manager
    prompt: "Read the contents of: {{ .workflow.input.filename }}"
    condition: 'workflow.input.filename'

  - id: create_summary
    type: basic
    agent: file_manager
    prompt: |
      Create a summary of the workspace contents:
      Files found: {{ .tasks.list_workspace_files.output }}
      {{ if .tasks.read_specific_file.output }}
      Content of {{ .workflow.input.filename }}: {{ .tasks.read_specific_file.output }}
      {{ end }}
```

**This pattern demonstrates:**
- **Simple MCP registration**: Single filesystem server using stdio transport
- **Agent tool access**: Agent can use MCP tools transparently
- **Workflow integration**: MCP servers available throughout the workflow
- **Error handling**: Built-in error handling for MCP server failures

### Multiple MCP Servers Integration

For more complex scenarios, you can configure multiple MCP servers within a single workflow. Use the CLI to manage these workflows:

```yaml title="multi-server-workflow.yaml"
resource: workflow
id: multi-server-example
description: Workflow using multiple MCP servers

# Multiple MCP server configuration
mcps:
  - id: filesystem
    transport: stdio
    command: "mcp-server-filesystem"
    args: ["--root", "/workspace"]
    env:
      LOG_LEVEL: "info"

  - id: database
    transport: stdio
    command: "mcp-server-database"
    args: ["--connection", "postgresql://localhost/db"]
    env:
      QUERY_TIMEOUT: "30s"

agents:
  - id: data_processor
    instructions: |
      You can access both the filesystem and database.
      Use the filesystem for reading configuration files and the database for storing results.

tasks:
  - id: read_config
    type: basic
    agent: data_processor
    prompt: "Read the configuration file from /workspace/config.json"

  - id: process_data
    type: basic
    agent: data_processor
    prompt: |
      Process the data based on the configuration: {{ .tasks.read_config.output }}
      Store the results in the database.

  - id: verify_storage
    type: basic
    agent: data_processor
    prompt: "Verify that the data was stored correctly in the database"
```

### Dynamic MCP Server Selection

You can configure conditional MCP server loading based on workflow context:

```yaml
resource: workflow
id: adaptive-mcp-workflow
description: Conditional MCP server selection based on input parameters

mcps:
  - id: local_filesystem
    transport: stdio
    command: npx
    args: ["-y", "@modelcontextprotocol/server-filesystem", "./"]
    condition: 'workflow.input.environment == "local"'

  - id: database_server
    transport: stdio
    command: python
    args: ["mcp_server_database.py", "--connection-string", "{{ .env.DATABASE_URL }}"]
    condition: 'workflow.input.operation_type == "database"'

agents:
  - id: adaptive_assistant
    instructions: |
      You are an assistant that uses different MCP servers based on the task context.
      The available MCP servers will vary based on the environment and operation type.

tasks:
  - id: adaptive_operation
    type: basic
    agent: adaptive_assistant
    prompt: |
      Task: {{ .workflow.input.task }}
      Environment: {{ .workflow.input.environment }}
      Operation Type: {{ .workflow.input.operation_type }}

      Use the appropriate MCP tools available for this context to complete the task.
```

**Key benefits of conditional MCP loading:**
- **Resource efficiency**: Only load MCP servers when needed
- **Environment-specific behavior**: Different servers for different environments
- **Operation-specific access**: Control which servers are available for specific operations
- **Simple configuration**: Use standard template conditions

## Workflow Integration Patterns

### CLI Development Workflow

The recommended development workflow uses the Compozy CLI for seamless integration:

```bash
# 1. Initialize project with MCP support
compozy init data-processing-project
cd data-processing-project

# 2. Start development server with hot reload
compozy dev --watch

# 3. In another terminal, start MCP proxy
compozy mcp-proxy --debug

# 4. Test your workflow
compozy workflow execute --workflow-id data-processing-workflow
```

### Basic MCP Tool Usage

For simple data processing workflows, refer to the **Single MCP Server Integration** pattern above with these key principles:

- Use focused agents with clear instructions for specific data operations
- Structure tasks in logical sequence (read → process → save)
- Leverage template variables for dynamic file paths and formats
- Implement proper error handling for file operations

## Checklist

<List>
  <ListItem title="Project Setup" icon="Rocket">
    Use `compozy init` to create a new project with MCP support
  </ListItem>
  <ListItem title="Development Environment" icon="Code">
    Start development server with `compozy dev --watch` for hot reload
  </ListItem>
  <ListItem title="MCP Proxy Setup" icon="Settings">
    Start MCP proxy with `compozy mcp-proxy --debug` for development
  </ListItem>
  <ListItem title="Configuration Phase" icon="Settings">
    Configure MCP servers with proper command arguments and environment variables
  </ListItem>
  <ListItem title="Implementation Phase" icon="Code">
    Create agents with access to MCP tools and build workflows
  </ListItem>
  <ListItem title="Testing Phase" icon="CheckCircle">
    Test with `compozy workflow execute --workflow-id <id>` and verify tool registration
  </ListItem>
  <ListItem title="Deployment Phase" icon="Cloud">
    Deploy with `compozy start` and proper logging configuration
  </ListItem>
  <ListItem title="Maintenance Phase" icon="RefreshCw">
    Monitor with CLI commands and update configurations as needed
  </ListItem>
</List>

This guide provides practical patterns for integrating MCP servers with Compozy agents and workflows using the simple HTTP-based proxy architecture.

## Best Practices

<FeatureCardList cols={2} size="default">
  <FeatureCard
    title="Simple Configuration"
    description="Use clear MCP server commands with proper arguments and environment variables"
    icon="Settings"
  />
  <FeatureCard
    title="Error Handling"
    description="Handle MCP server failures gracefully with clear error messages"
    icon="Shield"
  />
  <FeatureCard
    title="Environment Management"
    description="Use environment variables for configuration and secrets"
    icon="Key"
  />
  <FeatureCard
    title="Transport Selection"
    description="Choose appropriate transport (stdio or SSE) based on MCP server capabilities"
    icon="Network"
  />
  <FeatureCard
    title="Tool Organization"
    description="Structure your MCP tools for easy discovery and maintenance"
    icon="FolderOpen"
  />
  <FeatureCard
    title="Testing Strategy"
    description="Test MCP integrations with realistic data and scenarios"
    icon="CheckCircle"
  />
</FeatureCardList>

## Next Steps

<ReferenceCardList>
  <ReferenceCard
    title="MCP Overview"
    description="Learn about MCP architecture and core concepts"
    href="/docs/core/mcp/overview"
    icon="BookOpen"
  />
</ReferenceCardList>
