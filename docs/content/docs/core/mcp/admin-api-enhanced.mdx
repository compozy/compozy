---
title: "Production Deployment Guide"
description: "Best practices and advanced patterns for deploying MCP servers in production environments"
---

This guide covers best practices for deploying and managing MCP servers in production environments using Compozy's admin API and proxy infrastructure.

<Callout type="info" icon="Rocket">
  **Production Ready**: Follow these patterns to deploy MCP servers reliably in production with proper monitoring and management.
</Callout>

## Production Architecture

A typical production MCP deployment includes:

<Mermaid chart={`graph TB
    subgraph "Load Balancer"
        LB[Load Balancer<br/>HTTPS Termination]
    end

    subgraph "MCP Proxy Cluster"
        P1[MCP Proxy 1<br/>:8081]
        P2[MCP Proxy 2<br/>:8081]
        P3[MCP Proxy N<br/>:8081]
    end

    subgraph "MCP Servers"
        FS[Filesystem Server]
        DB[Database Server]
        API[API Server]
    end

    subgraph "Monitoring"
        LOGS[Centralized Logging]
        METRICS[Metrics Collection]
        ALERTS[Alerting]
    end

    LB --> P1
    LB --> P2
    LB --> P3
    P1 --> FS
    P1 --> DB
    P1 --> API
    P2 --> FS
    P2 --> DB
    P2 --> API
    P3 --> FS
    P3 --> DB
    P3 --> API

    P1 --> LOGS
    P2 --> LOGS
    P3 --> LOGS
    P1 --> METRICS
    P2 --> METRICS
    P3 --> METRICS
    METRICS --> ALERTS

    classDef proxy fill:#f3e5f5,stroke:#4a148c,stroke-width:2px
    classDef servers fill:#e8f5e8,stroke:#1b5e20,stroke-width:2px
    classDef monitoring fill:#fff2e1,stroke:#d97706,stroke-width:2px

    class P1,P2,P3 proxy
    class FS,DB,API servers
    class LOGS,METRICS,ALERTS monitoring
`} />

## Production Configuration

### Environment Variables

Set these environment variables for production deployment:

```bash
# MCP Proxy Configuration
export MCP_PROXY_HOST=0.0.0.0
export MCP_PROXY_PORT=8081
export MCP_PROXY_BASE_URL=https://your-domain.com

# Security Configuration  
export MCP_PROXY_ADMIN_TOKEN=your-secure-token
export MCP_PROXY_TRUSTED_PROXIES=10.0.0.0/8,172.16.0.0/12

# Logging and Monitoring
export LOG_LEVEL=info
export ENABLE_METRICS=true
```

### Production MCP Server Config

```yaml
# production-mcps.yaml
mcps:
  - id: filesystem-prod
    command: "mcp-server-filesystem"
    args: ["--root", "/data/workspace"]
    transport: stdio
    env:
      LOG_LEVEL: "info"
      MAX_FILE_SIZE: "100MB"
    start_timeout: 30s
    max_sessions: 50

  - id: database-prod
    url: "http://internal-db-mcp:3000"
    transport: sse
    proto: "2025-03-26"
    env:
      DB_POOL_SIZE: "20"
      QUERY_TIMEOUT: "30s"
    max_sessions: 100
```

## Deployment Strategies

### Docker Deployment

```dockerfile
# Dockerfile for MCP Proxy
FROM alpine:latest

RUN apk add --no-cache ca-certificates
COPY compozy /usr/bin/compozy

EXPOSE 8081
HEALTHCHECK --interval=30s --timeout=10s --start-period=5s --retries=3 \
  CMD wget --no-verbose --tries=1 --spider http://localhost:8081/healthz || exit 1

CMD ["compozy", "mcp-proxy"]
```

```yaml
# docker-compose.yml
version: '3.8'
services:
  mcp-proxy:
    build: .
    ports:
      - "8081:8081"
    environment:
      - MCP_PROXY_HOST=0.0.0.0
      - MCP_PROXY_PORT=8081
      - MCP_PROXY_ADMIN_TOKEN=${ADMIN_TOKEN}
    healthcheck:
      test: ["CMD", "wget", "--spider", "http://localhost:8081/healthz"]
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped
```

### Kubernetes Deployment

```yaml
# k8s-deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: mcp-proxy
spec:
  replicas: 3
  selector:
    matchLabels:
      app: mcp-proxy
  template:
    metadata:
      labels:
        app: mcp-proxy
    spec:
      containers:
      - name: mcp-proxy
        image: your-registry/mcp-proxy:latest
        ports:
        - containerPort: 8081
        env:
        - name: MCP_PROXY_ADMIN_TOKEN
          valueFrom:
            secretKeyRef:
              name: mcp-secrets
              key: admin-token
        livenessProbe:
          httpGet:
            path: /healthz
            port: 8081
          initialDelaySeconds: 30
          periodSeconds: 10
        readinessProbe:
          httpGet:
            path: /healthz
            port: 8081
          initialDelaySeconds: 5
          periodSeconds: 5
```

## Monitoring and Observability

### Health Checks

Implement comprehensive health monitoring:

```bash
# Basic health check
curl -f http://localhost:8081/healthz || exit 1

# Check MCP servers via admin API
curl -s http://localhost:8081/admin/mcps \
  -H "Authorization: Bearer $ADMIN_TOKEN" | jq .
```

### Log Management

Configure structured logging for production:

```yaml
# logging-config.yaml
runtime:
  log_level: info
  structured_logging: true
  log_format: json
  
  # Log fields to include
  log_fields:
    - timestamp
    - level
    - message
    - mcp_name
    - tool_name
    - duration
    - error
```

## Security Hardening

### Network Security

```yaml
# Security configuration
security:
  # Restrict admin API access
  admin_allow_ips:
    - "10.0.0.0/8"
    - "172.16.0.0/12"
  
  # Rate limiting
  rate_limits:
    admin_api: "100/min"
    tool_calls: "1000/min"
  
  # TLS configuration (when using HTTPS)
  tls:
    min_version: "1.2"
    cipher_suites: ["TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384"]
```

### Authentication Best Practices

```bash
# Generate secure admin tokens
compozy auth generate \
  --name "production-admin" \
  --description "Production admin API access" \
  --expires "2024-12-31"

# Rotate tokens regularly
compozy auth revoke old-token-id
compozy auth generate --name "rotated-admin-token"
```

## CLI Command Reference

### Production Operations

```bash
# Start MCP proxy in production
compozy mcp-proxy \
  --host 0.0.0.0 \
  --port 8081 \
  --admin-tokens "$ADMIN_TOKEN" \
  --trusted-proxies "10.0.0.0/8"

# Monitor configuration
compozy config show --format yaml
compozy config diagnostics --verbose

# Workflow management
compozy workflow list --format json
compozy workflow execute health-check-workflow
```

## Best Practices Summary

<Tabs items={["Deployment", "Security", "Monitoring", "Performance"]}>

<Tab>
### Deployment Best Practices

- Use container orchestration (Docker/Kubernetes) for scalability
- Implement health checks and graceful shutdowns
- Configure proper resource limits and requests
- Use blue-green or rolling deployments for zero downtime

</Tab>

<Tab>
### Security Best Practices

- Use strong authentication tokens with regular rotation
- Implement network-level access controls
- Enable TLS/HTTPS for all communications
- Monitor and log all administrative actions

</Tab>

<Tab>
### Monitoring Best Practices

- Implement comprehensive health checks
- Monitor key metrics (requests, errors, latency)
- Set up alerting for critical failures
- Use structured logging for better observability

</Tab>

<Tab>
### Performance Best Practices

- Configure appropriate connection pooling
- Set reasonable timeouts for operations
- Monitor resource usage and scale accordingly
- Use load balancing for high availability

</Tab>
</Tabs>

## Next Steps

<ReferenceCardList>
  <ReferenceCard
    title="Admin API"
    description="Core admin API functionality"
    href="/docs/core/mcp/admin-api"
    icon="Settings"
  />
  <ReferenceCard
    title="Client Manager"
    description="Understand MCP client management"
    href="/docs/core/mcp/client-manager"
    icon="Network"
  />
  <ReferenceCard
    title="Integration Patterns"
    description="Advanced integration patterns"
    href="/docs/core/mcp/integration-patterns"
    icon="Workflow"
  />
  <ReferenceCard
    title="Development & Debugging"
    description="Debug and develop MCP integrations"
    href="/docs/core/mcp/development-debugging"
    icon="Bug"
  />
</ReferenceCardList>