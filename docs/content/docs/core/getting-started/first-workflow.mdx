---
title: First Workflow
description: Interactive walkthrough to build your first complete workflow
---

import {
  BrainCircuit,
  GitBranch,
  FileCode,
  Zap,
  Search,
  AlertTriangle,
  CheckCircle,
  Database,
  Radio,
  Link2,
  Calendar,
  Users,
  Shield,
  BarChart3,
  HeadphonesIcon,
  Cpu,
  PenTool,
  Github,
  MessageSquare,
  FileText
} from "lucide-react";

In this comprehensive tutorial, you'll build a complete AI-powered workflow that demonstrates Compozy's core features. We'll create a **Go Code Analyzer** that analyzes Go source files for performance issues and best practices using Claude Code SDK, showcasing parallel task execution and advanced AI-powered code analysis.

## Related Concepts

<ReferenceCardList>
  <ReferenceCard
    title="Agent Configuration"
    description="Setting up AI agents with specific instructions"
    href="/docs/core/agents/overview"
    icon={BrainCircuit}
  />
  <ReferenceCard
    title="Task Orchestration"
    description="Coordinating multiple processing steps"
    href="/docs/core/tasks/basic-tasks"
    icon={GitBranch}
  />
  <ReferenceCard
    title="YAML Templates"
    description="Dynamic configuration and data flow"
    href="/docs/core/yaml-templates/overview"
    icon={FileCode}
  />
  <ReferenceCard
    title="Provider Integration"
    description="Connecting to LLM services"
    href="/docs/core/configuration/providers"
    icon={Zap}
  />
</ReferenceCardList>

## What You'll Build

By the end of this tutorial, you'll have a workflow that:

<List>
  <ListItem title="File Path Input">Accepts Go source file paths for comprehensive code analysis</ListItem>
  <ListItem title="Performance Analysis">Uses Claude Code SDK to analyze performance bottlenecks and optimization opportunities</ListItem>
  <ListItem title="Best Practices Review">Evaluates Go code against established best practices and idioms</ListItem>
  <ListItem title="Parallel Processing">Demonstrates concurrent analysis tasks for maximum efficiency</ListItem>
  <ListItem title="Report Generation">Creates detailed Markdown reports with findings and recommendations</ListItem>
</List>

## Prerequisites

Before starting, ensure you have:
- Compozy installed and running ([Installation Guide](/docs/getting-started/installation))
- Basic understanding of [Core Concepts](/docs/getting-started/core-concepts)
- A text editor or IDE
- API key for Claude API (we'll use Anthropic's Claude Code SDK)
- Go source files to analyze (or use our provided sample)


## Building the project

<Steps numbered className="mt-8">

<Step title="Project Setup" description="Create a new directory and configure your project">

Create a new directory for your workflow project:

```bash
mkdir go-code-analyzer
cd go-code-analyzer
```

You'll be creating a project with the following structure:

<ProjectStructure
  structure={[
    {
      id: "go-code-analyzer",
      name: "go-code-analyzer/",
      children: [
      {
        id: "agents",
        name: "agents/",
        children: [
          { id: "go-code-analyzer-yaml", name: "go_code_analyzer.yaml" }
        ]
      },
      {
        id: "reports",
        name: "reports/",
        children: [
          { id: "performance-analysis-md", name: "performance-analysis.md" },
          { id: "best-practices-analysis-md", name: "best-practices-analysis.md" }
        ]
      },
        { id: "compozy-yaml", name: "compozy.yaml" },
        { id: "workflow-yaml", name: "workflow.yaml" },
        { id: "entrypoint-ts", name: "entrypoint.ts" },
        { id: "claude-analyzer-ts", name: "claude_analyzer.ts" },
        { id: "report-reader-ts", name: "report_reader.ts" },
        { id: "sample-go", name: "sample.go" },
        { id: "test-http", name: "test.http" },
        { id: "env-file", name: ".env" },
      ],
    },
  ]}
  initialSelectedId="go-code-analyzer"
  initialExpandedItems={["go-code-analyzer", "agents", "reports"]}
/>

### Project Configuration

Create `compozy.yaml` to define your project:

```yaml title="compozy.yaml"
name: go-code-analyzer
version: "1.0.0"
description: AI-powered Go code analysis using Claude Code SDK

author:
  name: Your Name
  url: https://github.com/yourusername

workflows:
  - source: ./workflow.yaml

models:
  - provider: anthropic
    model: claude-3-opus-20240229
    api_key: "{{ .env.CLAUDE_API_KEY }}"

runtime:
  type: bun
  entrypoint: "./entrypoint.ts"
  permissions:
    - --allow-read
    - --allow-write
    - --allow-net
    - --allow-env
```

### Environment Setup

Create `.env` file:

```bash title=".env"
# Get your API key from https://console.anthropic.com
CLAUDE_API_KEY=your_claude_api_key_here
```

### Sample Go File for Testing

Create `sample.go` to test the analyzer:

```go title="sample.go"
package main

import (
    "fmt"
    "time"
)

// UserService handles user operations
type UserService struct {
    users map[string]User
}

// User represents a user in the system
type User struct {
    ID       string
    Name     string
    Email    string
    Created  time.Time
}

// GetUser retrieves a user by ID (potential performance issue)
func (s *UserService) GetUser(id string) *User {
    // TODO: This could be optimized with better data structures
    for _, user := range s.users {
        if user.ID == id {
            return &user
        }
    }
    return nil
}

// CreateUser adds a new user
func (s *UserService) CreateUser(name, email string) error {
    if name == "" || email == "" {
        return fmt.Errorf("name and email are required")
    }

    user := User{
        ID:      fmt.Sprintf("user_%d", time.Now().Unix()),
        Name:    name,
        Email:   email,
        Created: time.Now(),
    }

    s.users[user.ID] = user
    return nil
}
```

</Step>

<Step title="Create Analysis Tools" description="Build TypeScript tools using Claude Code SDK and Bun runtime">

<Tabs items={["Entrypoint", "Claude Code Analyzer", "Report Reader"]} className="mt-6">

<Tab value="Entrypoint">

```typescript title="entrypoint.ts"
import { claudeCodeAnalyzer } from "./claude_analyzer.ts";
import { reportReader } from "./report_reader.ts";

// Export tools with snake_case keys for Compozy runtime
export default {
  claude_code_analyzer: claudeCodeAnalyzer,
  report_reader: reportReader,
};
```

</Tab>

<Tab value="Claude Code Analyzer">

```typescript title="claude_analyzer.ts"
import { query } from "@anthropic-ai/claude-code";

interface ClaudeAnalyzerInput {
  prompt: string;
}

interface ClaudeAnalyzerOutput {
  analysis_result: string;
  success: boolean;
}

export async function claudeCodeAnalyzer(
  input: ClaudeAnalyzerInput
): Promise<ClaudeAnalyzerOutput> {
  try {
    let analysisResult = "";

    // Use Claude Code SDK for analysis
    for await (const message of query({
      prompt: input.prompt,
      options: {
        outputFormat: "text",
        maxTurns: 1,
      },
    })) {
      if (message.type === "assistant" && message.content) {
        analysisResult = message.content;
        break;
      }
    }

    if (!analysisResult) {
      throw new Error("No analysis result generated from Claude Code");
    }

    return {
      analysis_result: analysisResult,
      success: true,
    };
  } catch (error: any) {
    throw new Error(`Claude Code analysis failed: ${error.message}`);
  }
}
```

</Tab>

<Tab value="Report Reader">

```typescript title="report_reader.ts"
import { readFile } from "fs/promises";
import { existsSync } from "fs";
import { resolve } from "path";

interface ReportReaderInput {
  report_path: string;
}

interface ReportReaderOutput {
  content: string;
  success: boolean;
  file_path: string;
}

export async function reportReader(
  input: ReportReaderInput
): Promise<ReportReaderOutput> {
  // Resolve the absolute path
  const absolutePath = resolve(input.report_path);

  // Check if file exists
  if (!existsSync(absolutePath)) {
    throw new Error(`Report file not found: ${input.report_path}`);
  }

  try {
    // Read the report file content
    const content = await readFile(absolutePath, "utf8");

    return {
      content,
      success: true,
      file_path: absolutePath,
    };
  } catch (error: any) {
    throw new Error(`Failed to read report file: ${error.message}`);
  }
}
```

</Tab>
</Tabs>

</Step>

<Step title="Define Go Code Analyzer Agent" description="Create an AI agent specialized in Go code analysis">

Create `agents/go_code_analyzer.yaml`:

```yaml title="agents/go_code_analyzer.yaml"
resource: agent
id: go_code_analyzer
description: AI agent specialized in Go code analysis for performance and best practices
version: 1.0.0

config:
  provider: anthropic
  model: claude-3-opus-20240229
  api_key: "{{ .env.CLAUDE_API_KEY }}"

instructions: |
  You are an expert Go developer and code reviewer with deep knowledge of:
  - Go performance optimization and profiling
  - Go best practices and idiomatic patterns
  - Concurrent programming in Go
  - Memory management and garbage collection
  - Go standard library and ecosystem

  Your role is to analyze Go code and provide detailed, actionable reports.
  Always provide specific, implementable suggestions with code examples when appropriate.
  Focus on practical improvements that will have measurable impact.

tools:
  - $ref: local::tools.#(id=="claude_code_analyzer")

actions:
  - id: analyze_performance
    prompt: |
      Use the Claude Code analyzer tool to analyze the Go file for performance issues.

      Call the tool with this prompt:

      You are an expert Go code reviewer specializing in performance analysis.

      Analyze the Go file: {{ .input.file_path }} for performance issues.

      Provide a comprehensive performance analysis focusing on:
      - Performance bottlenecks and optimization opportunities
      - Memory usage patterns and potential leaks
      - Algorithm complexity and efficiency issues
      - Concurrent code patterns and potential race conditions
      - Specific optimizations with code examples

      Create a detailed markdown report with:
      1. Executive summary with performance score (0-100)
      2. Critical performance issues with line numbers
      3. Optimization recommendations with before/after code examples
      4. Memory analysis and suggestions
      5. Algorithmic complexity assessment

      Write the complete report to the file: {{ .input.output_path }}/performance-analysis.md

  - id: analyze_best_practices
    prompt: |
      Use the Claude Code analyzer tool to analyze the Go file for best practices compliance.

      Call the tool with this prompt:

      You are an expert Go code reviewer specializing in Go best practices and idioms.

      Analyze the Go file: {{ .input.file_path }} for best practices compliance.

      Provide a comprehensive best practices analysis focusing on:
      - Idiomatic Go code patterns and style
      - Error handling best practices
      - Code organization and naming conventions
      - Documentation and comment quality
      - Testing considerations and testability
      - Security implications and vulnerabilities

      Create a detailed markdown report with:
      1. Executive summary with compliance score (0-100)
      2. Best practice violations with line numbers and severity
      3. Recommendations for improving code quality
      4. Examples of idiomatic Go alternatives
      5. Security and maintainability considerations

      Write the complete report to the file: {{ .input.output_path }}/best-practices-analysis.md
```

</Step>

<Step title="Create the Main Workflow" description="Orchestrate all components into a cohesive workflow">

```yaml title="workflow.yaml" height="100px"
id: go-code-analyzer
version: 1.0.0
description: AI-powered Go code analysis using Claude Code SDK with parallel processing

config:
  input:
    type: object
    properties:
      file_path:
        type: string
        description: Path to the Go source file to analyze
        pattern: "^.*\\.go$"
      output_path:
        type: string
        description: Directory path for the generated analysis reports
        default: "./reports"
    required:
      - file_path

tools:
  - id: claude_code_analyzer
    description: Analyzes Go code using Claude Code SDK
    input:
      type: object
      properties:
        prompt:
          type: string
          description: Analysis prompt for Claude Code SDK
      required:
        - prompt

  - id: report_reader
    description: Reads report files and returns content
    input:
      type: object
      properties:
        report_path:
          type: string
          description: Path to report file
      required:
        - report_path

agents:
  - $ref: resource::agent::#(id=="go_code_analyzer")

tasks:
  # Phase 1: Parallel Analysis
  - id: parallel_analysis
    type: parallel
    description: Run performance and best practices analysis in parallel
    strategy: wait_all
    tasks:
      - id: performance_analysis
        type: basic
        description: Analyze Go code for performance issues
        $use: agent(local::agents.#(id=="go_code_analyzer"))
        action: analyze_performance
        with:
          file_path: "{{ .workflow.input.file_path }}"
          output_path: "{{ .workflow.input.output_path }}"
        outputs:
          analysis_result: "{{ .output }}"

      - id: best_practices_analysis
        type: basic
        description: Analyze Go code for best practices compliance
        $use: agent(local::agents.#(id=="go_code_analyzer"))
        action: analyze_best_practices
        with:
          file_path: "{{ .workflow.input.file_path }}"
          output_path: "{{ .workflow.input.output_path }}"
        outputs:
          analysis_result: "{{ .output }}"
    on_success:
      next: read_reports

  # Phase 2: Read Generated Reports
  - id: read_reports
    type: parallel
    description: Read the generated analysis reports
    strategy: wait_all
    tasks:
      - id: read_performance_report
        type: basic
        description: Read performance analysis report
        $use: tool(local::tools.#(id=="report_reader"))
        with:
          report_path: "{{ .workflow.input.output_path }}/performance-analysis.md"
        outputs:
          performance_report: "{{ .output }}"

      - id: read_best_practices_report
        type: basic
        description: Read best practices analysis report
        $use: tool(local::tools.#(id=="report_reader"))
        with:
          report_path: "{{ .workflow.input.output_path }}/best-practices-analysis.md"
        outputs:
          best_practices_report: "{{ .output }}"
    final: true

# Workflow outputs
outputs:
  analysis_complete: true
  file_analyzed: "{{ .workflow.input.file_path }}"
  reports_directory: "{{ .workflow.input.output_path }}"
  performance_report: "{{ .tasks.read_reports.children.read_performance_report.output.performance_report }}"
  best_practices_report: "{{ .tasks.read_reports.children.read_best_practices_report.output.best_practices_report }}"
```

</Step>

<Step title="Test Your Workflow" description="Validate the workflow with sample content">

Create `test.http` with the following content to test your workflow:

```http title="test.http"
### Execute the Go code analyzer workflow
POST http://localhost:8000/api/v0/workflows/go-code-analyzer/execute
Content-Type: application/json

{
  "input": {
    "file_path": "./sample.go",
    "output_path": "./reports"
  }
}

### Check execution status
GET http://localhost:8000/api/v0/executions/{{execution_id}}
```

### Expected Output

Your workflow should return analysis results like this:

```json
{
  "execution_id": "exec_123456",
  "status": "completed",
  "outputs": {
    "analysis_complete": true,
    "file_analyzed": "./sample.go",
    "reports_directory": "./reports",
    "performance_report": {
      "content": "# Performance Analysis Report\n\n## Executive Summary\n\nPerformance Score: 65/100\n\n...",
      "success": true,
      "file_path": "/absolute/path/to/reports/performance-analysis.md"
    },
    "best_practices_report": {
      "content": "# Best Practices Analysis Report\n\n## Executive Summary\n\nCompliance Score: 72/100\n\n...",
      "success": true,
      "file_path": "/absolute/path/to/reports/best-practices-analysis.md"
    }
  }
}
```

</Step>

</Steps>

## Understanding the Workflow

Your workflow demonstrates several key Compozy concepts:

<List>
  <ListItem title="Parallel execution">
    Performance and best practices analysis run simultaneously for efficiency
  </ListItem>
  <ListItem title="Agent actions">
    Specialized AI actions with detailed prompts for different analysis types
  </ListItem>
  <ListItem title="File-based reporting">
    AI agents write detailed reports to disk for persistence
  </ListItem>
  <ListItem title="Tool composition">
    Simple tools combined to create powerful analysis workflows
  </ListItem>
  <ListItem title="Resource references">
    External agent configurations loaded dynamically
  </ListItem>
</List>

### Task Dependencies

<Mermaid chart={`graph TD
    A[parallel_analysis<br/><i>parallel task</i>] --> B[read_reports<br/><i>parallel task</i>]

    A --> A1[performance_analysis<br/><i>basic task + agent action</i>]
    A --> A2[best_practices_analysis<br/><i>basic task + agent action</i>]

    B --> B1[read_performance_report<br/><i>basic task + tool</i>]
    B --> B2[read_best_practices_report<br/><i>basic task + tool</i>]

    A1 --> |writes file| C1[performance-analysis.md]
    A2 --> |writes file| C2[best-practices-analysis.md]

    C1 --> B1
    C2 --> B2`} />

## Next Steps

Congratulations! You've built a sophisticated AI-powered content analysis workflow. Here's how to continue learning:

### Advanced Features

<ReferenceCardList>
  <ReferenceCard
    title="Memory Systems"
    description="Add persistent memory for user preferences and conversation history"
    href="/docs/core/memory/memory-concepts"
    icon={Database}
  />
  <ReferenceCard
    title="Signal Tasks"
    description="Create event-driven workflows with cross-workflow communication"
    href="/docs/core/signals/signal-overview"
    icon={Radio}
  />
  <ReferenceCard
    title="MCP Integration"
    description="Connect external services and APIs using Model Context Protocol"
    href="/docs/core/mcp/mcp-overview"
    icon={Link2}
  />
  <ReferenceCard
    title="Scheduled Workflows"
    description="Automate content analysis with cron-based scheduling"
    href="/docs/core/scheduling/overview"
    icon={Calendar}
  />
</ReferenceCardList>

### Workflow Patterns

<ReferenceCardList>
  <ReferenceCard
    title="Multi-Agent Patterns"
    description="Coordinate multiple AI agents for complex orchestration"
    href="/docs/core/agents/multi-agent-patterns"
    icon={Users}
  />
  <ReferenceCard
    title="Error Handling"
    description="Implement robust error recovery and retry strategies"
    href="/docs/core/tasks/flow-control"
    icon={Shield}
  />
  <ReferenceCard
    title="Performance Optimization"
    description="Scale your workflows with parallel processing and caching"
    href="/docs/core/tasks/parallel-processing"
    icon={BarChart3}
  />
</ReferenceCardList>

### Real-World Applications

<ReferenceCardList>
  <ReferenceCard
    title="Content Generation"
    description="Build automated content creation and optimization workflows"
    href="/docs/core/examples/content-generation"
    icon={PenTool}
  />
  <ReferenceCard
    title="Customer Support"
    description="Create AI-powered support systems with intelligent routing"
    href="/docs/core/examples/customer-support"
    icon={HeadphonesIcon}
  />
  <ReferenceCard
    title="Data Processing"
    description="Design batch analysis pipelines for large-scale data"
    href="/docs/core/examples/data-processing"
    icon={Cpu}
  />
</ReferenceCardList>

### Community & Resources

<ReferenceCardList>
  <ReferenceCard
    title="GitHub Repository"
    description="Explore source code, examples, and contribute to the project"
    href="https://github.com/compozy/compozy"
    icon={Github}
  />
  <ReferenceCard
    title="Discord Community"
    description="Get help, share projects, and connect with other developers"
    href="https://discord.gg/compozy"
    icon={MessageSquare}
  />
  <ReferenceCard
    title="Documentation"
    description="Access complete reference guides and API documentation"
    href="https://docs.compozy.dev"
    icon={FileText}
  />
</ReferenceCardList>

You now have the foundation to build complex AI workflows with Compozy. The patterns you've learned here can be adapted to countless use cases across different industries and applications.
