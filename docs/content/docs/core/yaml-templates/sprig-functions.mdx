---
title: "Sprig Functions"
description: "Complete reference for Sprig functions available in Compozy templates"
---

Compozy's template engine includes the full [Sprig function library](https://masterminds.github.io/sprig/), providing powerful data transformation capabilities within your YAML templates. This reference covers the most commonly used functions organized by category.

## Function Categories

<FeatureCardList cols={3}>
  <FeatureCard title="String Functions" icon="Type" href="#string-functions">
    Text manipulation, formatting, and validation
  </FeatureCard>
  <FeatureCard title="Numeric Functions" icon="Calculator" href="#numeric-functions">
    Mathematical operations and comparisons
  </FeatureCard>
  <FeatureCard title="Collection Functions" icon="List" href="#collection-functions">
    Array and map operations
  </FeatureCard>
  <FeatureCard title="Date Functions" icon="Calendar" href="#date-functions">
    Date formatting and arithmetic
  </FeatureCard>
  <FeatureCard title="Security Functions" icon="Shield" href="#security-functions">
    XSS protection and safe escaping
  </FeatureCard>
  <FeatureCard title="Encoding Functions" icon="Code" href="#encoding-functions">
    JSON, URL, and Base64 encoding
  </FeatureCard>
</FeatureCardList>

<Callout type="info">
  For security best practices, see the [Security Functions](#security-functions) section below.
</Callout>

## String Functions

String functions handle text manipulation, formatting, and validation operations.

<Tabs items={["Basic Operations", "Formatting", "Validation"]}>
<Tab>
**Basic string operations** cover case conversion, trimming, and replacement:

```yaml
# Case conversion
title: "{{ .user.name | title }}"                    # "john doe" → "John Doe"
upper: "{{ .status | upper }}"                       # "success" → "SUCCESS"  
lower: "{{ .env.NODE_ENV | lower }}"                 # "PRODUCTION" → "production"

# Trimming whitespace
cleaned: "{{ .input | trim }}"                       # "  hello  " → "hello"
trimPrefix: "{{ .filename | trimPrefix 'tmp_' }}"    # "tmp_file.txt" → "file.txt"
trimSuffix: "{{ .filename | trimSuffix '.txt' }}"    # "file.txt" → "file"

# String replacement
slug: "{{ .title | lower | replace ' ' '-' }}"       # "My Title" → "my-title"
sanitized: "{{ .input | replace '/' '_' }}"          # "path/to/file" → "path_to_file"
```

**Common patterns**: Chain functions for complex transformations, use consistent naming conventions.
</Tab>

<Tab>
**String formatting** provides printf-style formatting and padding:

```yaml
# Printf-style formatting
formatted: "{{ printf '%s-%04d' .prefix .number }}"  # "user-0001"
padded: "{{ printf '%10s' .name }}"                  # Right-padded to 10 chars
decimal: "{{ printf '%.2f' .price }}"                # Two decimal places

# Quotes and escaping
quoted: "{{ .value | quote }}"                       # Wraps in double quotes
squote: "{{ .value | squote }}"                      # Wraps in single quotes

# Substring operations
first_chars: "{{ .text | substr 0 5 }}"              # First 5 characters
last_chars: "{{ .text | substr -3 }}"                # Last 3 characters
```

**Use cases**: File naming, display formatting, database operations.
</Tab>

<Tab>
**String validation** tests string properties and content:

```yaml
# Content checks
has_error: "{{ .message | contains 'error' }}"       # Check for substring
is_email: "{{ .input | contains '@' }}"              # Basic email validation
starts_with: "{{ .path | hasPrefix '/api/' }}"       # Path validation

# Empty checks
is_empty: "{{ .value | empty }}"                     # true if empty/nil
has_value: "{{ .value | empty | not }}"              # true if not empty

# Comparison operations
is_production: "{{ .env.NODE_ENV | eq 'production' }}"
is_dev_mode: "{{ .env.NODE_ENV | has 'dev test' }}"
```

**Validation patterns**: Always validate input before processing, use consistent validation rules.
</Tab>
</Tabs>

## Numeric Functions

Numeric functions handle mathematical operations, comparisons, and type conversions.

<Tabs items={["Arithmetic", "Comparisons", "Utilities"]}>
<Tab>
**Arithmetic operations** perform basic mathematical calculations:

```yaml
# Basic math
sum: "{{ add 10 5 }}"                                # 15
difference: "{{ sub 10 5 }}"                         # 5
product: "{{ mul 10 5 }}"                            # 50
quotient: "{{ div 10 5 }}"                           # 2
remainder: "{{ mod 10 3 }}"                          # 1

# With template variables
total: "{{ add .price .tax }}"
percentage: "{{ div (mul .part 100) .total }}"
scaled: "{{ mul .value .scale_factor }}"
```

**Use cases**: Price calculations, percentage computations, data scaling.
</Tab>

<Tab>
**Comparison operations** test numeric relationships:

```yaml
# Comparison operators
is_greater: "{{ gt .score 80 }}"                     # Greater than
is_less: "{{ lt .age 18 }}"                          # Less than
is_equal: "{{ eq .status 200 }}"                     # Equal
is_not_equal: "{{ ne .result 'error' }}"             # Not equal
is_gte: "{{ ge .score 70 }}"                         # Greater than or equal
is_lte: "{{ le .attempts 3 }}"                       # Less than or equal
```

**Conditional logic**: Use comparisons for routing, validation, and flow control.
</Tab>

<Tab>
**Utility functions** provide min/max, rounding, and conversion:

```yaml
# Min/max values
minimum: "{{ min .value1 .value2 .value3 }}"
maximum: "{{ max .attempts 1 5 }}"

# Rounding operations
rounded: "{{ round .float_value }}"                   # Round to nearest integer
ceiling: "{{ ceil .float_value }}"                    # Round up
floor: "{{ floor .float_value }}"                     # Round down

# Type conversions
to_int: "{{ .string_number | int }}"                  # String to integer
to_float: "{{ .string_float | float64 }}"             # String to float
to_string: "{{ .number | toString }}"                 # Number to string
```

**Precision**: Be aware of floating-point precision in financial calculations.
</Tab>
</Tabs>

## Collection Functions

Collection functions operate on arrays and maps for data manipulation.

<Tabs items={["Array Operations", "Map Operations", "Transformations"]}>
<Tab>
**Array operations** work with lists and sequences:

```yaml
# Array properties
count: "{{ len .items }}"                             # Number of items
is_empty: "{{ empty .items }}"                        # true if empty array

# Element access
first_item: "{{ first .items }}"                      # First element
last_item: "{{ last .items }}"                        # Last element
rest_items: "{{ rest .items }}"                       # All except first
nth_item: "{{ index .items 2 }}"                      # Third element (0-indexed)

# Array membership
has_item: "{{ has .item .items }}"                    # Check if array contains item
```

**Array patterns**: Use consistent indexing, check bounds before access.
</Tab>

<Tab>
**Map operations** handle key-value data structures:

```yaml
# Map properties
all_keys: "{{ keys .config }}"                        # Array of keys
all_values: "{{ values .config }}"                    # Array of values
key_count: "{{ len .config }}"                        # Number of keys

# Key operations
has_key: "{{ hasKey .config 'database' }}"            # Check for key existence
get_value: "{{ .config.database | default 'sqlite' }}" # Get with default

# Map manipulation
subset: "{{ pick .config 'host' 'port' 'database' }}" # Create subset map
without: "{{ omit .config 'password' 'secret' }}"     # Exclude keys
```

**Map patterns**: Use consistent key naming, provide defaults for missing keys.
</Tab>

<Tab>
**Transformation functions** modify and process collections:

```yaml
# Array transformations
joined: "{{ .tags | join ',' }}"                      # "tag1,tag2,tag3"
sorted: "{{ .names | sortAlpha }}"                    # Alphabetical sort
unique: "{{ .items | uniq }}"                         # Remove duplicates
reversed: "{{ .items | reverse }}"                    # Reverse order

# Complex operations
filtered: "{{ .items | compact }}"                    # Remove empty values
chunked: "{{ .items | chunk 3 }}"                     # Group into chunks of 3
```

**Performance**: Large collections may impact template rendering speed.
</Tab>
</Tabs>

## Date Functions

Date functions handle time formatting, arithmetic, and manipulation.

<Tabs items={["Current Time", "Formatting", "Arithmetic"]}>
<Tab>
**Current time functions** provide various timestamp formats:

```yaml
# Current timestamp
now_timestamp: "{{ now }}"                            # Current time object
unix_timestamp: "{{ now | unixEpoch }}"               # Unix timestamp
nano_timestamp: "{{ now | date_in_zone 'UTC' | date '2006-01-02T15:04:05.000000000Z' }}"

# Common formats
current_date: "{{ now | date '2006-01-02' }}"         # "2023-10-15"
current_time: "{{ now | date '15:04:05' }}"           # "14:30:25"
iso_format: "{{ now | date '2006-01-02T15:04:05Z' }}" # ISO 8601 format
```

**Timezone handling**: Use `date_in_zone` for specific timezone formatting.
</Tab>

<Tab>
**Date formatting** converts timestamps to readable strings:

```yaml
# Common date formats
us_date: "{{ .timestamp | date '01/02/2006' }}"       # "10/15/2023"
eu_date: "{{ .timestamp | date '02/01/2006' }}"       # "15/10/2023"
full_date: "{{ .timestamp | date 'January 2, 2006' }}" # "October 15, 2023"
log_format: "{{ .timestamp | date '2006-01-02 15:04:05' }}"

# Custom formats
filename_safe: "{{ .timestamp | date '20060102_150405' }}"
human_readable: "{{ .timestamp | date 'Mon Jan 2 15:04:05 2006' }}"
```

**Format reference**: Go uses `2006-01-02 15:04:05` as the reference time for formatting.
</Tab>

<Tab>
**Date arithmetic** performs time calculations:

```yaml
# Add/subtract time
expires_at: "{{ now | dateModify '+24h' }}"           # 24 hours from now
yesterday: "{{ now | dateModify '-24h' }}"            # 24 hours ago
next_week: "{{ now | dateModify '+168h' }}"           # 7 days from now

# Complex calculations
deadline: "{{ .start_date | dateModify '+2h30m' }}"   # Add 2.5 hours
window_end: "{{ .event_time | dateModify '+1h' }}"    # One hour window

# Duration calculations
elapsed: "{{ sub (now | unixEpoch) (.start_time | unixEpoch) }}"
```

**Duration units**: Use `h` (hours), `m` (minutes), `s` (seconds) for time arithmetic.
</Tab>
</Tabs>

## Security Functions

Security functions provide XSS protection and safe escaping for different contexts.

<Callout type="info">
  **Security Best Practice**: Always escape user input before rendering in HTML, JavaScript, or other contexts to prevent XSS attacks. Compozy provides built-in functions for safe escaping.
</Callout>

<Tabs items={["HTML Escaping", "JavaScript Escaping", "Security Patterns"]}>
<Tab>
**HTML escaping** prevents XSS in HTML content and attributes:

```yaml
# HTML content escaping
user_message: "{{ .user_input | htmlEscape }}"
blog_content: "{{ .tasks.get_content.output.text | htmlEscape }}"

# Example transformations:
# Input: "<script>alert('XSS')</script>"
# Output: "&lt;script&gt;alert('XSS')&lt;/script&gt;"

# HTML attribute escaping
user_profile: |
  <div class="user-card" 
       data-name="{{ .user.name | htmlAttrEscape }}"
       title="{{ .user.bio | htmlAttrEscape }}">
    {{ .user.display_name | htmlEscape }}
  </div>

# Example transformations:
# Input: 'John" onclick="alert(\'XSS\')'
# Output: 'John&quot; onclick=&quot;alert(&#39;XSS&#39;)'
```

**Context awareness**: Use `htmlEscape` for content, `htmlAttrEscape` for attributes.
</Tab>

<Tab>
**JavaScript escaping** protects against script injection:

```yaml
# Safe JavaScript variables
user_data_script: |
  <script>
    var userName = '{{ .user.name | jsEscape }}';
    var config = {
      userId: '{{ .user.id | jsEscape }}',
      sessionId: '{{ .workflow.id | jsEscape }}'
    };
  </script>

# Safe event handlers
onclick_handler: |
  <button onclick="handleClick('{{ .item.id | jsEscape }}')">
    {{ .item.name | htmlEscape }}
  </button>

# Example transformations:
# Input: "'; alert('XSS'); var x='"
# Output: "\'; alert(\'XSS\'); var x\u003D\'"
```

**JavaScript contexts**: Always use `jsEscape` for JavaScript string literals.
</Tab>

<Tab>
**Security patterns** combine multiple escaping functions:

```yaml
# Multi-context security
secure_notification: |
  <div class="notification" 
       data-message="{{ .message | htmlAttrEscape }}">
    <span>{{ .message | htmlEscape }}</span>
    <script>
      logNotification('{{ .message | jsEscape }}');
    </script>
  </div>

# Input validation with escaping
safe_form_input: |
  {{ if and .user_input (le (len .user_input) 100) }}
    {{ .user_input | htmlEscape }}
  {{ else }}
    [Invalid input]
  {{ end }}

# Template injection prevention
safe_template: |
  {{ $safeValue := .user_input | htmlEscape }}
  {{ if not (contains $safeValue "{{") }}
    {{ $safeValue }}
  {{ else }}
    [Filtered: Template syntax detected]
  {{ end }}
```

**Defense in depth**: Validate input, escape output, use appropriate context-specific functions.
</Tab>
</Tabs>

## Encoding Functions

Encoding functions handle data serialization and format conversion.

<Tabs items={["JSON", "URL Encoding", "Base64"]}>
<Tab>
**JSON operations** convert between objects and JSON strings:

```yaml
# Convert to JSON
json_string: "{{ .data | toJson }}"                   # Convert object to JSON
pretty_json: "{{ .data | toPrettyJson }}"             # Pretty-printed JSON

# Parse JSON (use with caution)
parsed_data: "{{ .json_string | fromJson }}"          # Parse JSON string

# Common use cases
api_payload: "{{ .request_data | toJson }}"
config_dump: "{{ .config | toPrettyJson }}"
```

**JSON safety**: Validate JSON strings before parsing, handle parse errors gracefully.
</Tab>

<Tab>
**URL encoding** ensures safe URL construction:

```yaml
# URL component encoding
encoded_param: "{{ .search_query | urlquery }}"       # URL encode query params
encoded_path: "{{ .file_path | urlpath }}"            # URL encode path segments

# Build safe URLs
api_url: "{{ .base_url }}/users/{{ .user_id | urlpath }}?q={{ .query | urlquery }}"
redirect_url: "{{ .app_url }}?return={{ .return_url | urlquery }}"
```

**URL construction**: Always encode user input in URLs to prevent injection.
</Tab>

<Tab>
**Base64 encoding** handles binary data and authentication:

```yaml
# Base64 operations
encoded: "{{ .data | b64enc }}"                       # Base64 encode
decoded: "{{ .encoded_data | b64dec }}"               # Base64 decode

# Authentication headers
auth_header: "Basic {{ printf '%s:%s' .username .password | b64enc }}"
api_key: "Bearer {{ .token | b64enc }}"

# File content encoding
file_content: "{{ .binary_data | b64enc }}"
```

**Base64 use cases**: Authentication, binary data transmission, file embedding.
</Tab>
</Tabs>

## Logical Functions

Logical functions provide conditional operations and flow control.

<Tabs items={["Boolean Logic", "Conditionals", "Defaults"]}>
<Tab>
**Boolean operations** combine and test conditions:

```yaml
# Boolean logic
both_true: "{{ and .condition1 .condition2 }}"       # Logical AND
either_true: "{{ or .condition1 .condition2 }}"      # Logical OR
negated: "{{ not .condition }}"                       # Logical NOT

# Complex expressions
valid_user: "{{ and .user.verified (not (empty .user.email)) }}"
should_process: "{{ or .force_process (and .auto_process (gt .priority 5)) }}"
```

**Complex conditions**: Use parentheses to control evaluation order.
</Tab>

<Tab>
**Conditional operations** provide if-then-else logic:

```yaml
# Ternary operator
status: "{{ .error | empty | ternary 'success' 'failed' }}"
message: "{{ .user.premium | ternary 'Welcome VIP!' 'Welcome!' }}"

# Conditional assignment
timeout: "{{ if .config.timeout }}{{ .config.timeout }}{{ else }}30{{ end }}"
level: "{{ if eq .env.NODE_ENV 'production' }}info{{ else }}debug{{ end }}"
```

**Ternary syntax**: `condition | ternary 'true_value' 'false_value'`
</Tab>

<Tab>
**Default values** handle missing or empty data:

```yaml
# Simple defaults
username: "{{ .user.name | default 'Anonymous' }}"
timeout: "{{ .config.timeout | default 30 }}"
retries: "{{ .config.retries | default 3 }}"

# Coalesce (first non-empty value)
name: "{{ coalesce .user.nickname .user.first_name .user.email 'Unknown' }}"
endpoint: "{{ coalesce .config.primary_url .config.backup_url .default_url }}"
```

**Fallback chains**: Use `coalesce` for multiple fallback options.
</Tab>
</Tabs>

## Common Patterns

Real-world examples of function usage in typical scenarios.

<Tabs items={["Configuration", "Data Processing", "Workflow Logic"]}>
<Tab>
**Configuration management** with environment-based settings:

```yaml
# Environment-based configuration
database_url: "{{ .env.DATABASE_URL | default 'sqlite://local.db' }}"
debug_mode: "{{ .env.DEBUG | default 'false' | bool }}"
port: "{{ .env.PORT | default '3000' | int }}"

# Feature flags
feature_enabled: "{{ and .env.ENABLE_FEATURE (eq .env.ENVIRONMENT 'production') }}"
log_level: "{{ .env.LOG_LEVEL | default 'info' | lower }}"
```

**Best practices**: Provide sensible defaults, validate environment variables.
</Tab>

<Tab>
**Data processing** with transformation and validation:

```yaml
# File operations
output_file: "{{ .input_file | trimSuffix '.txt' }}_processed.json"
backup_name: "{{ printf '%s_%s' .filename (now | date '20060102_150405') }}"

# Data validation
valid_email: "{{ and (contains .email '@') (gt (len .email) 5) }}"
valid_age: "{{ and (ge .age 0) (le .age 150) }}"

# Data transformation
normalized: "{{ .text | lower | trim | replace ' ' '_' }}"
```

**Validation patterns**: Always validate before processing, provide clear error messages.
</Tab>

<Tab>
**Workflow logic** with dynamic task management:

```yaml
# Task naming
task_id: "{{ printf '%s_%s_%d' .workflow.id .task_type .index }}"
batch_id: "{{ printf 'batch_%s' (now | date '20060102_150405') }}"

# Conditional execution
should_retry: "{{ and (gt .attempts 0) (lt .attempts .max_retries) }}"
is_urgent: "{{ or (eq .priority 'high') (lt .deadline (now | dateModify '+1h')) }}"

# Error handling
error_context: "{{ printf 'Task %s failed: %s' .task_id (.error | default 'unknown error') }}"
```

**Workflow patterns**: Use consistent naming, implement proper error handling.
</Tab>
</Tabs>

## Performance Considerations

Understanding function performance helps optimize template rendering.

<Tabs items={["Fast Functions", "Expensive Operations", "Optimization"]}>
<Tab>
**High-performance functions** execute quickly:

```yaml
# Fast operations (< 1μs)
fast_ops: |
  {{ .name | title }}                    # ~0.5μs
  {{ .text | trim }}                     # ~0.3μs
  {{ .status | upper }}                  # ~0.2μs
  {{ .value | default "none" }}          # ~0.4μs
  {{ len .items }}                       # ~0.1μs
  {{ add .a .b }}                        # ~0.1μs
```

**Optimal usage**: Prefer simple functions for frequently rendered templates.
</Tab>

<Tab>
**Expensive operations** may impact performance:

```yaml
# Slower operations (1-10μs)
expensive_ops: |
  {{ .items | sortAlpha }}               # ~10μs for 100 items
  {{ .items | uniq }}                    # ~5μs for 100 items
  {{ .text | regexFind "pattern" }}      # ~3μs
  {{ .data | toJson }}                   # ~2μs for medium objects
```

**Performance tips**: Cache results, minimize expensive operations in loops.
</Tab>

<Tab>
**Optimization strategies** improve template performance:

```yaml
# Efficient chaining
efficient: |
  {{ $cleaned := .input | trim | lower }}
  {{ $processed := $cleaned | replace " " "-" }}
  {{ $final := $processed | trimSuffix ".tmp" }}
  Result: {{ $final }}

# Conditional processing
optimized: |
  {{ if .config.enable_processing }}
    {{ .data | expensiveOperation }}
  {{ else }}
    {{ .data.cached_result }}
  {{ end }}
```

**Best practices**: Use variables for intermediate results, avoid redundant operations.
</Tab>
</Tabs>

## References

<ReferenceCardList>
  <ReferenceCard
    title="Context Variables"
    description="Learn about data sources and access patterns in templates"
    href="/docs/core/yaml-templates/context-variables"
    icon="Database"
  />
  <ReferenceCard
    title="Template Directives"
    description="Use $ref and $use directives for resource composition"
    href="/docs/core/yaml-templates/directives"
    icon="Link"
  />
</ReferenceCardList>

Sprig functions provide the foundation for powerful template-based configurations in Compozy. Remember to prioritize security by always escaping user input and using appropriate functions for each context.
