---
title: Overview
description: Compozy's YAML template engine enables dynamic configuration by combining standard YAML syntax with Go template expressions. This allows you to create flexible, reusable configurations that adapt to different contexts and data sources.
---

<Callout type="info" title="Key Benefits">
Templates eliminate hardcoded values and enable data-driven workflows by injecting dynamic values from context, environment variables, and task outputs.
</Callout>

## Core Capabilities

<FeatureCardList cols={2} size="default">
  <FeatureCard
    title="Dynamic Values"
    description="Inject data from workflow context, environment variables, and task outputs"
    icon="Database"
  />
  <FeatureCard
    title="Resource References"
    description="Reference other resources using `$ref` and `$use` directives"
    icon="Link"
  />
  <FeatureCard
    title="Data Transformations"
    description="Apply Sprig functions and custom filters to modify data"
    icon="Filter"
  />
  <FeatureCard
    title="Conditional Logic"
    description="Create routing and decision-making logic within templates"
    icon="GitBranch"
  />
</FeatureCardList>

## Template Expression Syntax

Template expressions use **Go template syntax** wrapped in double curly braces. Here are the essential patterns:

<Tabs items={["Basic Values", "Transformations", "Conditionals"]}>
<Tab>

### Basic Value Injection

Access data from your workflow context:

```yaml
# Access workflow input
city: "{{ .workflow.input.city }}"

# Access environment variables
api_key: "{{ .env.OPENAI_API_KEY }}"

# Access task outputs
weather: "{{ .tasks.weather_check.output.temperature }}"
```

**When to use**: Direct access to known data sources without transformation.

</Tab>

<Tab>

### Data Transformations

Transform data using Sprig functions:

```yaml
# Format dates
timestamp: "{{ now | date '2006-01-02' }}"

# String manipulation
name: "{{ .user.name | title }}"

# Math operations
total: "{{ .price | mul 1.1 }}"
```

**When to use**: When you need to format, calculate, or manipulate data before using it.

</Tab>

<Tab>

### Conditional Logic

Make decisions based on data:

```yaml
# Simple conditional
route: '{{ .status | eq "success" | ternary "continue" "retry" }}'

# Complex conditional
priority: |
  {{- if eq .user.type "premium" -}}
    high
  {{- else if gt .order.amount 1000 -}}
    medium
  {{- else -}}
    low
  {{- end -}}
```

**When to use**: When you need different behavior based on runtime conditions.

</Tab>
</Tabs>

## Common Use Cases

<Tabs items={["Dynamic Task Config", "Conditional Routing", "Data Processing"]}>
<Tab>

### Dynamic Task Configuration

Configure tasks based on runtime data:

```yaml
- id: api_call
  type: basic
  $use: tool(local::tools.#(id=="http_request"))
  with:
    url: "{{ .env.API_BASE_URL }}/users/{{ .workflow.input.user_id }}"
    method: "{{ .workflow.input.method | default 'GET' }}"
    headers:
      Authorization: "Bearer {{ .env.API_TOKEN }}"
```

**Use case**: When you need to configure tasks with different URLs, parameters, or settings based on input data.

</Tab>

<Tab>

### Conditional Routing

Route workflows based on conditions:

```yaml
- id: result_router
  type: router
  condition: '{{ .tasks.validation.output.valid | ternary "success" "failure" }}'
  routes:
    success:
      $ref: local::tasks.#(id="process_success")
    failure:
      $ref: local::tasks.#(id="handle_error")
```

**Use case**: When you need different workflow paths based on validation results, user types, or business logic.

</Tab>

<Tab>

### Data Processing

Process collections of data:

```yaml
- id: process_items
  type: collection
  items: "{{ .workflow.input.data_items }}"
  task:
    id: "process-{{ .index }}"
    type: basic
    $use: tool(local::tools.#(id=="data_processor"))
    with:
      item: "{{ .item }}"
      batch_id: "{{ .workflow.id }}_{{ .index }}"
```

**Use case**: When you need to process arrays of data with individual handling for each item.

</Tab>
</Tabs>

## Template Processing

The template engine processes your YAML configurations in **5 phases**:

<Steps numbered size="sm">
  <Step title="Parse Phase" description="YAML structure is parsed and template expressions are identified" icon="FileText">

  The engine identifies template expressions marked with `{{ }}` and prepares them for processing.

  </Step>

  <Step title="Context Resolution" description="Context data is gathered from workflow state and environment" icon="Database">

  Data from workflow input, task outputs, and environment variables is collected into a context map.

  </Step>

  <Step title="Template Rendering" description="Go templates are executed with the context data" icon="Code">

  Template expressions are evaluated using the Go template engine with Sprig functions.

  </Step>

  <Step title="Type Conversion" description="Results are converted to appropriate types" icon="ArrowRight">

  String results are converted to numbers, booleans, or objects as needed.

  </Step>

  <Step title="Reference Resolution" description="Resource references are resolved to actual resources" icon="Link">

  `$ref` and `$use` directives are resolved to actual schemas, tools, and agents.

  </Step>
</Steps>

## Security Features

<Callout type="warning" title="Security First">
The template engine includes **XSS prevention** functions to safely handle user input in HTML contexts.
</Callout>

### Available Security Functions

<FeatureCardList cols={3} size="sm">
  <FeatureCard
    title="htmlEscape"
    description="Escapes HTML content to prevent XSS attacks"
    icon="Shield"
  />
  <FeatureCard
    title="htmlAttrEscape"
    description="Escapes HTML attribute values safely"
    icon="Shield"
  />
  <FeatureCard
    title="jsEscape"
    description="Escapes JavaScript strings securely"
    icon="Shield"
  />
</FeatureCardList>

### Security Best Practice

```yaml
# ❌ DANGEROUS: Direct user input
dangerous_output: "{{ .user_input }}"

# ✅ SAFE: Properly escaped user input
safe_output: "{{ .user_input | htmlEscape }}"
```

<Callout type="info" title="Best Practice">
Always escape user input and untrusted data to prevent XSS vulnerabilities.
</Callout>

## References

Build your template expertise progressively:

<ReferenceCardList>
  <ReferenceCard
    title="YAML Basics"
    description="Learn fundamental YAML syntax and structure patterns"
    href="./yaml-basics"
    icon="FileText"
  />
  <ReferenceCard
    title="Context Variables"
    description="Understand available data sources and access patterns"
    href="./context-variables"
    icon="Database"
  />
  <ReferenceCard
    title="Template Directives"
    description="Master resource references with `$ref` and `$use`"
    href="./directives"
    icon="Link"
  />
  <ReferenceCard
    title="Sprig Functions"
    description="Transform and manipulate data with powerful functions"
    href="./sprig-functions"
    icon="Filter"
  />
  <ReferenceCard
    title="Advanced Patterns"
    description="Complex template scenarios and dynamic configurations"
    href="./advanced-patterns"
    icon="GitBranch"
  />
  <ReferenceCard
    title="Validation & Debugging"
    description="Troubleshoot issues and ensure template quality"
    href="./validation-debugging"
    icon="Bug"
  />
  <ReferenceCard
    title="Task Configuration"
    description="Use templates in task definitions"
    href="../tasks/basic-tasks"
    icon="Box"
  />
  <ReferenceCard
    title="Agent Instructions"
    description="Dynamic agent behavior with templates"
    href="../agents/instructions-actions"
    icon="Bot"
  />
  <ReferenceCard
    title="Workflow Orchestration"
    description="Template-driven workflow management"
    href="../configuration/workflows"
    icon="Workflow"
  />
</ReferenceCardList>
