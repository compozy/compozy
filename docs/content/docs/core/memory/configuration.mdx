---
title: "Memory Configuration"
description: "Complete guide to configuring memory resources for persistent agent context management, conversation continuity, and intelligent data retention"
---

<Callout type="info" title="Memory Configuration Overview">
Configure **persistent context management** for AI agents with conversation continuity, multi-agent context sharing, and intelligent data retention across workflow executions.
</Callout>

## Core Memory Capabilities

<FeatureCardList>
  <FeatureCard
    title="Conversation Continuity"
    description="Maintain conversation history across sessions with automatic token management and context preservation"
    icon="MessageSquare"
  />
  <FeatureCard
    title="Multi-Agent Context Sharing"
    description="Enable seamless context sharing between agents with hierarchical keys and access controls"
    icon="Users"
  />
  <FeatureCard
    title="Intelligent Data Management"
    description="Automated summarization, priority-based eviction, and token-aware capacity management"
    icon="Brain"
  />
  <FeatureCard
    title="Privacy & Security"
    description="Built-in data redaction, compliance controls, encryption, and audit logging"
    icon="Shield"
  />
</FeatureCardList>

## Quick Start Configuration

<Steps numbered>

<Step title="Create Memory Resource" description="Define your memory configuration">

```yaml title="memory/conversation.yaml"
resource: memory
id: conversation_memory
description: Stores conversation history for agents
version: 1.0.0

type: token_based
max_tokens: 2000
max_context_ratio: 0.8

persistence:
  type: redis
  ttl: 24h

privacy_policy:
  redact_patterns:
    - '\b\d{3}-\d{2}-\d{4}\b'  # SSN pattern
  default_redaction_string: "[REDACTED]"
```

</Step>

<Step title="Configure Agent Memory" description="Connect agents to memory resources">

```yaml title="agents/chat_agent.yaml"
resource: agent
id: chat_agent

config:
  model: gpt-4
  temperature: 0.7

memory:
  - id: conversation_memory
    key: "user:{{.workflow.input.user_id}}"
    mode: read-write
```

</Step>

</Steps>

## Related Documentation

<ReferenceCardList>
  <ReferenceCard
    title="Memory Operations"
    description="Use configured memory in workflows and agents with append, flush, and clear operations"
    href="/docs/core/memory/operations"
    icon="Play"
  />
  <ReferenceCard
    title="Integration Patterns"
    description="Multi-agent memory sharing, context isolation, and collaborative workflows"
    href="/docs/core/memory/integration-patterns"
    icon="Layers"
  />
  <ReferenceCard
    title="Privacy & Security"
    description="Data redaction, compliance, encryption, and audit logging"
    href="/docs/core/memory/privacy-security"
    icon="Shield"
  />
</ReferenceCardList>

## Basic Memory Resource Setup

### Foundation Configuration

<AccordionGroup>
<Accordion title="Memory Types" icon="Brain">

**Choose the right memory type for your use case:**

<Tabs items={["Token-Based", "Message Count", "Buffer"]} className="mt-4">

<Tab value="Token-Based">

```yaml title="memory.yaml"
resource: memory
id: my_token_memory
description: Token-optimized conversation memory
version: 1.0.0

# Token-based configuration
type: token_based
max_tokens: 2000
max_context_ratio: 0.8
model: gpt-4
```

**Best for:** LLM-optimized context management with precise token control

</Tab>

<Tab value="Message Count">

```yaml title="memory.yaml"
resource: memory
id: my_message_memory
description: Message count-based memory
version: 1.0.0

# Message count-based configuration
type: message_count_based
max_messages: 100
max_tokens: 4000  # Fallback limit
```

**Best for:** Predictable message limits and simpler token management

</Tab>

<Tab value="Buffer">

```yaml title="memory.yaml"
resource: memory
id: my_buffer_memory
description: Simple buffer memory for development
version: 1.0.0

# Buffer configuration
type: buffer
max_messages: 50
```

**Best for:** Development, testing, and simple use cases

</Tab>

</Tabs>

</Accordion>

<Accordion title="Memory Keys" icon="Key">

**Configure data isolation with key templates:**

<Tabs items={["User-Based", "Session-Based", "Hierarchical"]} className="mt-4">

<Tab value="User-Based">

```yaml
key: "user:{{.workflow.input.user_id}}"
```

**Best for:** Simple user isolation

</Tab>

<Tab value="Session-Based">

```yaml
key: "session:{{.session_id}}:{{.agent_id}}"
```

**Best for:** Multi-agent conversations

</Tab>

<Tab value="Hierarchical">

```yaml
key: "project:{{.project_id}}:user:{{.user_id}}:conversation:{{.conversation_id}}"
```

**Best for:** Multi-tenant applications

</Tab>

</Tabs>

</Accordion>

<Accordion title="Complete Configuration Template" icon="FileText">

```yaml title="complete_basic_memory.yaml"
resource: memory
id: complete_basic_memory
description: Complete basic memory configuration
version: 1.0.0

key: "user:{{.workflow.input.user_id}}"
type: token_based
max_tokens: 2000
max_context_ratio: 0.8
model: gpt-4

persistence:
  type: redis
  ttl: 24h

append_ttl: "30m"
clear_ttl: "5m"
flush_ttl: "2h"

eviction_policy:
  type: fifo
```

</Accordion>

</AccordionGroup>

### Persistence Configuration

<AccordionGroup>

<Accordion title="Redis Persistence (Recommended)" icon="Database">

```yaml
persistence:
  type: redis
  ttl: 168h  # 7 days

  circuit_breaker:
    enabled: true
    timeout: "100ms"
    max_failures: 5
    reset_timeout: "30s"

  pool:
    max_connections: 10
    min_idle: 2
    max_idle: 5
```

</Accordion>

<Accordion title="TTL Management" icon="Clock">

```yaml
# Base TTL for memory instances
persistence:
  ttl: 24h

# Operation-specific TTL extensions
append_ttl: "30m"    # Extend on append
clear_ttl: "5m"      # Short cleanup
flush_ttl: "2h"      # Preserve summaries

# Dynamic TTL
dynamic_ttl:
  enabled: true
  min_ttl: "1h"
  max_ttl: "7d"
  activity_threshold: 10
```

<Callout type="info" title="TTL Best Practices">
- Keep `append_ttl` shorter than base TTL
- Use short `clear_ttl` for cleanup
- Set longer `flush_ttl` to preserve summaries
</Callout>

</Accordion>

</AccordionGroup>

### Memory Management Configuration

<AccordionGroup>

<Accordion title="Eviction Policies" icon="ArrowDownUp">

**Choose the right eviction strategy:**

<Tabs items={["FIFO", "LRU", "Priority"]} className="mt-4">

<Tab value="FIFO">

```yaml
eviction_policy:
  type: fifo
```

**Best for:** Simple, predictable behavior

</Tab>

<Tab value="LRU">

```yaml
eviction_policy:
  type: lru
```

**Best for:** Interactive conversations

</Tab>

<Tab value="Priority">

```yaml
eviction_policy:
  type: priority
  priority_keywords:
    - "error"
    - "critical"
    - "important"
    - "user_preference"
  priority_boost: 2.0
  decay_rate: 0.1
```

**Best for:** Production systems with critical information

</Tab>

</Tabs>

</Accordion>

<Accordion title="Flushing Strategies" icon="Trash2">

**Configure capacity management:**

```yaml
# Hybrid Summary (Recommended)
flushing_strategy:
  type: hybrid_summary
  summarize_threshold: 0.8
  summary_tokens: 500
  summarize_oldest_percent: 0.3

# Token-Aware LRU
flushing_strategy:
  type: token_aware_lru
  target_utilization: 0.7
  min_messages: 5
```

**Strategy Comparison:**

| Strategy | Intelligence | Use Case |
|----------|-------------|----------|
| `hybrid_summary` | High | Production systems |
| `token_aware_lru` | Medium | Token-conscious workflows |
| `lru` | Medium | Interactive applications |

</Accordion>

</AccordionGroup>

## Privacy and Security Configuration

### Data Redaction

Configure sensitive data protection:

```yaml
privacy_policy:
  redact_patterns:
    # Personal identifiers
    - '\b\d{3}-\d{2}-\d{4}\b'  # SSN
    - '\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Z|a-z]{2,}\b'  # Email
    - '\b(?:\+?1[-.\s]?)?\(?[2-9]\d{2}\)?[-.\s]?\d{3}[-.\s]?\d{4}\b'  # Phone

    # Financial information
    - '\b\d{4}[\s-]?\d{4}[\s-]?\d{4}[\s-]?\d{3,6}\b'  # Credit cards

  redaction_config:
    default_redaction_string: "[REDACTED]"
    preserve_format: true
    case_sensitive: false

  non_persistable_message_types:
    - system
    - tool_internal
    - debug
```

## Configuration Templates

<Callout type="info" title="Ready-to-Use Templates">
Production-tested configuration templates for different deployment scenarios.
</Callout>

<Tabs items={["Development", "Production", "Enterprise"]} className="mt-6">

<Tab value="Development">

```yaml title="dev_memory.yaml"
resource: memory
id: dev_memory
description: Development memory configuration
version: 1.0.0

key: "user:{{.workflow.input.user_id}}"
type: token_based
max_tokens: 2000

persistence:
  type: redis
  ttl: 8h
```

<List>
  <ListItem icon="CheckCircle">**Use Case:** Local development and testing</ListItem>
  <ListItem icon="Clock">**TTL:** Short-term (8 hours)</ListItem>
  <ListItem icon="Shield">**Security:** Basic (no sensitive data handling)</ListItem>
</List>

</Tab>

<Tab value="Production">

```yaml title="prod_memory.yaml"
resource: memory
id: prod_memory
description: Production memory with security and monitoring
version: 2.0.0

key: "user:{{.user_id}}:session:{{.session_id}}"
type: token_based
max_tokens: 4000
max_context_ratio: 0.75

eviction_policy:
  type: priority
  priority_keywords: ["error", "critical", "important"]

persistence:
  type: redis
  ttl: 72h
  circuit_breaker:
    enabled: true
    timeout: "50ms"

privacy_policy:
  redact_patterns:
    - '\b\d{3}-\d{2}-\d{4}\b'  # SSN
    - '\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Z|a-z]{2,}\b'  # Email
  non_persistable_message_types: [system, tool_internal]
```

<List>
  <ListItem icon="CheckCircle">**Use Case:** Production applications with user data</ListItem>
  <ListItem icon="Clock">**TTL:** Extended (72 hours)</ListItem>
  <ListItem icon="Shield">**Security:** Data redaction and circuit breakers</ListItem>
</List>

</Tab>

<Tab value="Enterprise">

```yaml title="enterprise_memory.yaml"
resource: memory
id: enterprise_memory
description: Enterprise-grade memory with compliance
version: 2.0.0

key: "tenant:{{.tenant_id}}:user:{{.user_id}}:session:{{.session_id}}"
type: token_based
max_tokens: 4000
max_context_ratio: 0.75

persistence:
  type: redis
  ttl: 168h  # 7 days
  sentinel:
    enabled: true
    service_name: "redis-memory"
  circuit_breaker:
    enabled: true
    timeout: "50ms"
    max_failures: 3

privacy_policy:
  redact_patterns:
    - '\b\d{3}-\d{2}-\d{4}\b'
    - '\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Z|a-z]{2,}\b'
    - '\b(?:\+?1[-.\s]?)?\(?[2-9]\d{2}\)?[-.\s]?\d{3}[-.\s]?\d{4}\b'
    - '\b\d{4}[\s-]?\d{4}[\s-]?\d{4}[\s-]?\d{3,6}\b'
  non_persistable_message_types: [system, tool_internal, debug]

metadata:
  environment: "production"
  compliance: ["gdpr", "ccpa", "hipaa"]
```

<List>
  <ListItem icon="CheckCircle">**Use Case:** Multi-tenant enterprise applications</ListItem>
  <ListItem icon="Clock">**TTL:** Extended with HA (7 days)</ListItem>
  <ListItem icon="Shield">**Security:** Full compliance and multi-tenant isolation</ListItem>
</List>

</Tab>

</Tabs>

## Configuration Reference

### Core Configuration

Resource identification and basic settings:

```yaml
resource: memory        # Resource type (always "memory")
id: unique_memory_id   # Unique identifier
description: "Purpose and context"
version: "1.0.0"       # Configuration version

# Memory key template
key: "user:{{.workflow.input.user_id}}"
# or hierarchical: "project:{{.project_id}}:user:{{.user_id}}"

# Memory type
type: token_based       # or message_count_based, buffer
max_tokens: 4000
max_context_ratio: 0.8
model: gpt-4
```

**Available Template Variables:**
- `{{.workflow.input.*}}` - Workflow input parameters
- `{{.session_id}}`, `{{.project_id}}`, `{{.agent_id}}`, `{{.user_id}}`

### Eviction and Flushing

Control memory management strategies:

```yaml
# Eviction policies
eviction_policy:
  type: fifo            # or lru, priority

# For priority eviction
eviction_policy:
  type: priority
  priority_keywords: ["error", "critical", "important"]

# Flushing strategies
flushing_strategy:
  type: hybrid_summary  # or simple_fifo, lru, token_aware_lru
  summarize_threshold: 0.8
  summary_tokens: 500
```

### Persistence and TTL

Configure data storage and expiration:

```yaml
# Redis persistence (recommended)
persistence:
  type: redis
  ttl: 24h
  circuit_breaker:
    enabled: true
    timeout: "100ms"
    max_failures: 5

# TTL fine-tuning
append_ttl: "30m"    # Extend on append
clear_ttl: "5m"      # Short cleanup
flush_ttl: "1h"      # Preserve after flush
```

**TTL Formats:** `30s`, `5m`, `2h`, `24h`, `168h`

### Token Providers

Configure accurate token counting:

```yaml
# OpenAI provider
token_provider:
  provider: openai
  model: gpt-4
  api_key_env: OPENAI_API_KEY
  fallback: tiktoken

# Anthropic provider
token_provider:
  provider: anthropic
  model: claude-3-sonnet
  api_key_env: ANTHROPIC_API_KEY

# Local fallback
token_provider:
  provider: tiktoken
  model: gpt-4
```

### Privacy and Security Reference

Protect sensitive information:

```yaml
privacy_policy:
  redact_patterns:
    - '\b\d{3}-\d{2}-\d{4}\b'  # SSN
    - '\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Z|a-z]{2,}\b'  # Email
    - '\b\d{4}[\s-]?\d{4}[\s-]?\d{4}[\s-]?\d{3,6}\b'  # Credit cards

  non_persistable_message_types:
    - system
    - tool_internal
    - debug

  default_redaction_string: "[REDACTED]"
```

### Environment Variables

Use environment variables for sensitive data:

```yaml
# Direct reference
api_key: "{{ .env.OPENAI_API_KEY }}"

# With fallback
api_key: "{{ .env.OPENAI_API_KEY | default \"fallback-key\" }}"

# Conditional
api_key: "{{ if .env.USE_OPENAI }}{{ .env.OPENAI_API_KEY }}{{ else }}{{ .env.FALLBACK_KEY }}{{ end }}"
```
