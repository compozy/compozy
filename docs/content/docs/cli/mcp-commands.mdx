---
title: MCP Commands
description: Model Context Protocol server management and proxy operations through the Compozy CLI
icon: network
---

Manage Model Context Protocol (MCP) servers and proxy operations through the Compozy CLI. The MCP proxy server enables HTTP-based access to MCP servers, providing seamless integration between AI agents and external tools.

## Overview

<FeatureCardList cols={2} size="default">
  <FeatureCard
    title="HTTP Proxy Server"
    description="Provides HTTP endpoints for MCP server communication with authentication and security controls"
    icon="Globe"
  />
  <FeatureCard
    title="Admin API"
    description="Comprehensive server management interface with authentication and monitoring capabilities"
    icon="Settings"
  />
  <FeatureCard
    title="Security & Authentication"
    description="Global auth tokens, admin access controls, and IP-based restrictions for secure operations"
    icon="Shield"
  />
  <FeatureCard
    title="Production Ready"
    description="Built-in health checks, monitoring, logging, and deployment configurations for production use"
    icon="Rocket"
  />
</FeatureCardList>

## mcp-proxy

Start the MCP proxy server to provide HTTP access to MCP servers.

### Usage

```bash
compozy mcp-proxy [flags]
```

### Description

The MCP proxy server enables HTTP-based access to MCP servers, providing:
- HTTP endpoints for MCP server communication
- Admin API for server management
- Authentication and security controls
- Request logging and monitoring

### Flags

#### Server Configuration
```bash
--host string              # Host to bind the server to (default: "0.0.0.0")
--port string              # Port to run the MCP proxy server on (default: "8081")
--base-url string          # Base URL for the MCP proxy server
```

#### Security and Authentication
```bash
--global-auth-tokens strings    # Global auth tokens for all MCP clients
--admin-tokens strings          # Admin API tokens
--admin-allow-ips strings       # Admin API allowed IP addresses/CIDR blocks
--trusted-proxies strings       # Trusted proxy IP addresses/CIDR blocks
```

#### Debugging
```bash
--debug                    # Enable debug mode (sets log level to debug)
```

### Environment Variables

The MCP proxy respects these environment variables:

```bash
MCP_PROXY_HOST             # Host to bind the server to
MCP_PROXY_PORT             # Port to run the MCP proxy server on
MCP_PROXY_BASE_URL         # Base URL for the MCP proxy server
```

### Examples

#### Basic Usage

Start the MCP proxy with default settings:

```bash
compozy mcp-proxy
```

This starts the proxy on `0.0.0.0:8081`.

#### Custom Port and Host

```bash
compozy mcp-proxy --host localhost --port 9000
```

#### With Authentication

```bash
compozy mcp-proxy \
  --global-auth-tokens "token1,token2" \
  --admin-tokens "admin-secret" \
  --admin-allow-ips "192.168.1.0/24,10.0.0.0/8"
```

#### Debug Mode

```bash
compozy mcp-proxy --debug
```

#### Using Environment Variables

```bash
export MCP_PROXY_HOST=localhost
export MCP_PROXY_PORT=9000
export MCP_PROXY_BASE_URL=http://localhost:9000

compozy mcp-proxy
```

### API Endpoints

Once started, the MCP proxy provides these endpoints:

<Tabs items={["Health Checks", "MCP Operations", "Admin API"]}>

<Tab>
**Health monitoring and status endpoints:**

```bash
GET /health              # Basic health status
GET /health/detailed     # Detailed health information with metrics
```

Example response:
```json
{
  "status": "healthy",
  "version": "0.1.0",
  "uptime": "1h30m45s",
  "connections": {
    "active": 5,
    "total": 42
  }
}
```
</Tab>

<Tab>
**Core MCP server communication endpoints:**

```bash
POST /mcp/{server_id}    # Proxy requests to MCP servers
GET  /mcp/{server_id}    # Get MCP server information
```

Example usage:
```bash
# Get server information
curl http://localhost:8081/mcp/my-server

# Proxy MCP request
curl -X POST http://localhost:8081/mcp/my-server \
  -H "Content-Type: application/json" \
  -d '{"method": "tools/list", "params": {}}'
```
</Tab>

<Tab>
**Administrative management endpoints (requires admin authentication):**

```bash
GET    /admin/servers       # List configured MCP servers
POST   /admin/servers       # Add new MCP server
PUT    /admin/servers/{id}  # Update MCP server configuration
DELETE /admin/servers/{id}  # Remove MCP server
```

Example server registration:
```bash
curl -X POST http://localhost:8081/admin/servers \
  -H "Authorization: Bearer admin-token" \
  -H "Content-Type: application/json" \
  -d '{
    "id": "my-server",
    "name": "My MCP Server",
    "url": "http://localhost:3000",
    "auth_token": "server-specific-token"
  }'
```
</Tab>

</Tabs>

### Architecture Flow

<Mermaid chart={`sequenceDiagram
    participant Client as AI Agent/Client
    participant Proxy as MCP Proxy
    participant Admin as Admin API
    participant MCP as MCP Server
    participant DB as Config Store

    Note over Client,DB: MCP Proxy Architecture Flow

    Client->>Proxy: POST /mcp/server-id
    Proxy->>Proxy: Validate auth token
    Proxy->>DB: Get server config
    DB-->>Proxy: Server URL & credentials
    Proxy->>MCP: Forward MCP request
    MCP-->>Proxy: MCP response
    Proxy-->>Client: HTTP response

    Note over Admin,DB: Admin Operations
    Admin->>Proxy: POST /admin/servers
    Proxy->>Proxy: Validate admin token
    Proxy->>DB: Store server config
    DB-->>Proxy: Config saved
    Proxy-->>Admin: Success response

    Note over Proxy: Health & Monitoring
    loop Health Checks
        Proxy->>MCP: Ping MCP servers
        MCP-->>Proxy: Health status
        Proxy->>Proxy: Update metrics
    end`} />

### Configuration

The MCP proxy can be configured through:

1. **Command-line flags** (highest priority)
2. **Environment variables**
3. **Configuration file** (specified with `--config`)

#### Configuration File Example

```yaml
# mcp-proxy.yaml
mcp_proxy:
  host: "0.0.0.0"
  port: "8081"
  base_url: "http://localhost:8081"
  
  auth:
    global_tokens:
      - "your-auth-token"
    admin_tokens:
      - "admin-secret"
    admin_allow_ips:
      - "192.168.1.0/24"
      - "127.0.0.1"
  
  security:
    trusted_proxies:
      - "10.0.0.0/8"
      - "172.16.0.0/12"
      - "192.168.0.0/16"

  logging:
    level: "info"
    format: "json"
```

### Security Considerations

#### Authentication Tokens
- **Global auth tokens**: Required for all MCP client requests
- **Admin tokens**: Required for admin API access
- Use strong, randomly generated tokens
- Rotate tokens regularly

#### IP Restrictions
- **Admin IP allowlist**: Restrict admin API access by IP
- **Trusted proxies**: Configure known proxy IPs for proper client IP detection
- Use CIDR notation for IP ranges

#### Network Security
- Run behind a reverse proxy in production
- Use HTTPS termination at the proxy level
- Implement rate limiting and request size limits

### Monitoring and Logging

#### Health Monitoring

```bash
# Check basic health
curl http://localhost:8081/health

# Get detailed status
curl http://localhost:8081/health/detailed
```

#### Log Analysis

```bash
# Follow proxy logs (JSON format)
tail -f /var/log/compozy/mcp-proxy.log | jq '.'

# Filter for errors
grep '"level":"error"' /var/log/compozy/mcp-proxy.log | jq '.'

# Monitor request patterns
grep '"path":' /var/log/compozy/mcp-proxy.log | \
  jq -r '.path' | sort | uniq -c | sort -nr
```

### Production Deployment

#### Docker

```dockerfile
FROM compozy/compozy:latest
EXPOSE 8081
HEALTHCHECK --interval=30s --timeout=3s --start-period=5s --retries=3 \
  CMD curl -f http://localhost:8081/health || exit 1
CMD ["compozy", "mcp-proxy"]
```

#### Docker Compose

```yaml
version: '3.8'
services:
  mcp-proxy:
    image: compozy/compozy:latest
    command: ["compozy", "mcp-proxy"]
    ports:
      - "8081:8081"
    environment:
      - MCP_PROXY_HOST=0.0.0.0
      - MCP_PROXY_PORT=8081
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8081/health"]
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped
```

#### Kubernetes

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: mcp-proxy
spec:
  replicas: 2
  selector:
    matchLabels:
      app: mcp-proxy
  template:
    metadata:
      labels:
        app: mcp-proxy
    spec:
      containers:
      - name: mcp-proxy
        image: compozy/compozy:latest
        command: ["compozy", "mcp-proxy"]
        ports:
        - containerPort: 8081
        env:
        - name: MCP_PROXY_HOST
          value: "0.0.0.0"
        - name: MCP_PROXY_PORT
          value: "8081"
        livenessProbe:
          httpGet:
            path: /health
            port: 8081
          initialDelaySeconds: 30
          periodSeconds: 10
        readinessProbe:
          httpGet:
            path: /health
            port: 8081
          initialDelaySeconds: 5
          periodSeconds: 5
        resources:
          requests:
            memory: "64Mi"
            cpu: "50m"
          limits:
            memory: "256Mi"
            cpu: "200m"
```

### Troubleshooting

<Tabs items={["Common Issues", "Debug Commands", "Network Issues"]}>

<Tab>
**Port already in use**
```bash
# Check what's using the port
lsof -i :8081

# Use different port
compozy mcp-proxy --port 9000
```

**Permission denied**
```bash
# Don't run as root, use non-privileged port
compozy mcp-proxy --port 8081  # Good
compozy mcp-proxy --port 80    # Bad (requires root)
```

**Authentication failures**
```bash
# Check token configuration
compozy mcp-proxy --debug

# Verify token in requests
curl -H "Authorization: Bearer your-token" \
     http://localhost:8081/health
```
</Tab>

<Tab>
**Enable debug logging**
```bash
# Start with debug logging
compozy mcp-proxy --debug --log-level debug
```

**Test connectivity**
```bash
# Basic health check
curl -v http://localhost:8081/health

# Detailed health information
curl -v http://localhost:8081/health/detailed
```

**Check admin API**
```bash
# List configured servers (requires admin token)
curl -H "Authorization: Bearer admin-token" \
     http://localhost:8081/admin/servers

# Test MCP server connection
curl -X POST http://localhost:8081/mcp/server-id \
     -H "Content-Type: application/json" \
     -d '{"method": "ping"}'
```
</Tab>

<Tab>
**Cannot connect to MCP servers**

<List>
  <ListItem title="Server Accessibility">
    Verify MCP server URLs are accessible from the proxy host
  </ListItem>
  <ListItem title="Network Connectivity">
    Check firewall rules and network connectivity between proxy and MCP servers
  </ListItem>
  <ListItem title="Configuration Review">
    Ensure server configurations are correct in the admin API or config file
  </ListItem>
  <ListItem title="Authentication">
    Verify MCP server-specific authentication tokens are valid
  </ListItem>
</List>

**Network diagnostic commands:**
```bash
# Test MCP server directly
curl -v http://mcp-server-host:port/health

# Check DNS resolution
nslookup mcp-server-host

# Test network connectivity
telnet mcp-server-host port
```
</Tab>

</Tabs>

## Next Steps

Explore these related topics to get the most out of MCP proxy operations:

### Learn the Fundamentals

<ReferenceCardList>
  <ReferenceCard
    title="MCP Overview"
    description="Understand Model Context Protocol architecture and integration patterns"
    href="/docs/core/mcp/mcp-overview"
    icon="BookOpen"
  />
  <ReferenceCard
    title="MCP Configuration"
    description="Configure MCP servers, clients, and authentication strategies"
    href="/docs/core/mcp/configuration"
    icon="Settings"
  />
  <ReferenceCard
    title="Agent Tools Integration"
    description="Connect AI agents to external tools through MCP proxy"
    href="/docs/core/agents/tools"
    icon="Link"
  />
  <ReferenceCard
    title="Tool Development"
    description="Build custom MCP servers and tools for specialized operations"
    href="/docs/core/tools/tools-overview"
    icon="Code"
  />
</ReferenceCardList>

### Production & Operations

<ReferenceCardList>
  <ReferenceCard
    title="Production Deployment"
    description="Deploy and scale MCP proxy in production environments"
    href="/docs/core/mcp/production-deployment"
    icon="Rocket"
  />
  <ReferenceCard
    title="Monitoring & Metrics"
    description="Monitor MCP proxy operations and performance"
    href="/docs/core/mcp/monitoring-metrics"
    icon="BarChart3"
  />
  <ReferenceCard
    title="Security Best Practices"
    description="Secure MCP proxy deployments with authentication and network controls"
    href="/docs/core/mcp/security"
    icon="Shield"
  />
  <ReferenceCard
    title="CLI Reference"
    description="Complete command-line interface reference for all MCP operations"
    href="/docs/core/configuration/cli"
    icon="Terminal"
  />
</ReferenceCardList>