---
title: "Redis Configuration"
description: "Configure the cache layer for memory, persistent, and distributed modes."
icon: Database
---

Compozy’s cache layer supports three deployment modes:

- `memory`: embedded Redis with in-memory storage for zero-dependency workflows
- `persistent`: embedded Redis with on-disk snapshots for durable local state
- `distributed`: external Redis for shared staging and production environments

## Configuration Structure

```yaml title="compozy.yaml"
redis:
  mode: memory | persistent | distributed

  distributed:
    addr: localhost:6379
    password: ""
    db: 0
    tls:
      enabled: false
      insecure_skip_verify: false

  standalone: # Embedded Redis options used by memory and persistent modes
    persistence:
      enabled: false
      data_dir: ./.tmp/redis
      snapshot_interval: 60s
```

<Callout type="info">
Mode resolution: `redis.mode` (if set) → global `mode` (if set) → default `memory`.
</Callout>

## Distributed Mode (External Redis)

Use this for production and shared environments.

```yaml
redis:
  mode: distributed
  distributed:
    addr: redis.prod.internal:6379
    password: ${REDIS_PASSWORD}
    tls:
      enabled: true
```

### Environment Variables

| Path | Env |
| ---- | --- |
| `redis.mode` | `REDIS_MODE` |
| `redis.distributed.addr` | `REDIS_ADDR` |
| `redis.distributed.password` | `REDIS_PASSWORD` |
| `redis.distributed.db` | `REDIS_DB` |

## Embedded Modes (Memory & Persistent)

Memory and persistent modes run an embedded Redis‑compatible server inside the Compozy process. The `redis.standalone` block configures optional persistence shared by both modes.

```yaml
# Ephemeral memory mode (default)
redis:
  mode: memory
  standalone:
    persistence:
      enabled: true
      snapshot_interval: 60s

# File-backed persistent mode
redis:
  mode: persistent
  standalone:
    persistence:
      enabled: true
      data_dir: ./.compozy/redis
      snapshot_interval: 30s
      snapshot_on_shutdown: true
```

### Persistence Options

- `enabled`: turn on periodic snapshots for CI scenarios that need restarts
- `data_dir`: where snapshots are stored; ensure the process can write here
- `snapshot_interval`: snapshot frequency (`time.Duration` syntax)
- `snapshot_on_shutdown`: flush final snapshot during graceful shutdown
- `restore_on_startup`: automatically reload snapshots when the process starts

<Callout type="warning">
Embedded modes are single‑process and not HA. Use them for development and CI only.
</Callout>

## Performance Tuning

- Prefer `distributed` with managed Redis for high throughput
- For embedded modes, disable snapshots in tight loops to minimize I/O
- Use separate DB indexes (`db`) per tenant in shared dev boxes

## Monitoring & Metrics

- In distributed mode, use `INFO`, latency monitors, and your provider’s dashboards
- In embedded modes, monitor Compozy logs; enable debug logs when diagnosing cache behavior

## Troubleshooting

- "connection refused" (embedded): ensure the process owns the snapshot directory and no port conflicts
- Authentication failures (distributed): verify `password` and TLS settings
- Snapshot errors: validate `snapshot_interval` format and directory permissions

## See Also

<ReferenceCardList>
  <ReferenceCard
    title="Mode Configuration"
    description="Global defaults and inheritance"
    href="/docs/configuration/mode-configuration"
    icon="GitBranch"
  />
  <ReferenceCard
    title="Memory Mode Deployment"
    description="Zero-dependency local environment"
    href="/docs/deployment/memory-mode"
    icon="Rocket"
  />
  <ReferenceCard
    title="Persistent Mode Deployment"
    description="Embedded services with on-disk durability"
    href="/docs/deployment/persistent-mode"
    icon="Folder"
  />
</ReferenceCardList>
