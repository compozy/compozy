---
alwaysApply: true
---

# Zen MCP Tools Usage Guide

## Overview

Zen MCP (Model Context Protocol) tools provide advanced AI-assisted development capabilities including code analysis, debugging, code review, planning, and more. These tools integrate with multiple AI providers (OpenAI, Google Gemini, Anthropic, etc.) to deliver expert-level assistance.

## Core Requirements

### Mandatory Parameters

**Every Zen MCP tool call requires:**
- `model`: AI model to use (e.g., "gpt5", "flash", "gemini-2.5-pro", "o3")
  - Use `listmodels` to see available models
  - Common aliases: "gpt5", "flash", "pro", "mini", "nano", "o3", "gemini-pro"

### Multi-Step Tool Parameters

**For tools supporting multi-step workflows (debug, analyze, codereview, etc.):**
- `step`: Current step description/content
- `step_number`: Current step index (starts at 1)
- `total_steps`: Estimated total steps needed
- `next_step_required`: Boolean indicating if more steps are needed
- `findings`: Current discoveries/findings from this step

## Tool-Specific Requirements

### File-Based Tools

**Tools requiring file specifications:**
- `relevant_files`: Array of FULL absolute paths (never relative paths)
- `files_checked`: Array of examined file paths (for tracking)

**Examples:**
```json
{
  "relevant_files": ["/Users/username/project/main.go", "/Users/username/project/pkg/config/config.go"],
  "files_checked": ["/Users/username/project/main.go"]
}
```

**Validation:** Tools will fail with "All file paths must be FULL absolute paths" if relative paths are provided.

### Tool-Specific Parameters

#### codereview
- **Required:** `relevant_files` (full absolute paths)
- **Optional:** `review_type`, `focus_on`, `standards`, `severity_filter`
- **Purpose:** Systematic code review with expert validation

#### debug
- **Required:** Multi-step parameters
- **Optional:** `relevant_files`, `relevant_context`, `hypothesis`
- **Purpose:** Root cause analysis and debugging

#### analyze
- **Required:** `relevant_files` (full absolute paths)
- **Optional:** `analysis_type`, `output_format`
- **Purpose:** Architecture and code analysis

#### precommit
- **Required:** `path` (absolute path to git repository)
- **Optional:** `compare_to`, `include_staged`, `include_unstaged`
- **Purpose:** Pre-commit validation and change analysis

#### secaudit
- **Required:** Multi-step parameters
- **Optional:** `relevant_files`, `security_scope`, `threat_level`
- **Purpose:** Security audit and vulnerability assessment

#### refactor
- **Required:** Multi-step parameters
- **Optional:** `relevant_files`, `refactor_type`, `focus_areas`
- **Purpose:** Code refactoring analysis and recommendations

#### testgen
- **Required:** Multi-step parameters
- **Optional:** `relevant_files`
- **Purpose:** Test suite generation

#### docgen
- **Required:** Multi-step parameters + specific counters
- **Optional:** `relevant_files`, `document_complexity`, `document_flow`
- **Purpose:** Code documentation generation

#### tracer
- **Required:** `target_description`, `trace_mode`
- **Optional:** `relevant_files`
- **Purpose:** Code execution flow and dependency tracing

#### thinkdeep
- **Required:** Multi-step parameters
- **Optional:** `relevant_files`, `problem_context`, `focus_areas`
- **Purpose:** Deep investigation and analysis

### Planning and Chat Tools

#### planner
- **Required:** `step`, `step_number`, `total_steps`, `next_step_required`
- **Purpose:** Complex task planning and breakdown

#### consensus
- **Required:** `step`, `step_number`, `total_steps`, `next_step_required`, `findings`, `models`
- **Purpose:** Multi-model consensus building

#### chat
- **Required:** `prompt`
- **Optional:** `files`, `images`, `continuation_id`
- **Purpose:** Collaborative thinking and discussion

## Usage Patterns

### Basic Single-Step Tool Call

```json
{
  "tool_name": "codereview",
  "step": "Review authentication logic",
  "step_number": 1,
  "total_steps": 1,
  "next_step_required": false,
  "findings": "Initial code review",
  "relevant_files": ["/absolute/path/to/auth.go"],
  "model": "gpt5"
}
```

### Multi-Step Investigation Pattern

```json
{
  "tool_name": "debug",
  "step": "Investigate API timeout issue",
  "step_number": 1,
  "total_steps": 3,
  "next_step_required": true,
  "findings": "Found timeout in handler, checking database connection",
  "relevant_files": ["/path/to/handler.go", "/path/to/db.go"],
  "confidence": "medium",
  "hypothesis": "Database connection pool exhausted",
  "model": "o3"
}
```

### Continuation Pattern

**Step 1 Response:**
```json
{
  "continuation_id": "abc-123-def-456",
  "next_step_required": true
}
```

**Step 2 Call:**
```json
{
  "continuation_id": "abc-123-def-456",
  "step": "Continue investigation with new findings",
  "step_number": 2,
  "findings": "Updated findings based on previous step"
}
```

## Error Handling and Validation

### Common Validation Errors

**Missing Required Fields:**
```
"Value error, Step 1 requires 'relevant_files' field to specify code files or directories to review"
```

**Invalid File Paths:**
```
"All file paths must be FULL absolute paths. Invalid path: 'main.go'"
```

**Missing Path Parameter:**
```
"Value error, Step 1 requires 'path' field to specify git repository location"
```

**Model Not Configured:**
```
"Model 'invalid-model' is not available. Use listmodels to see available models"
```

### Status Responses

**Success States:**
- `"status": "calling_expert_analysis"` - Tool completed successfully with expert validation
- `"status": "local_work_complete"` - Local analysis complete, ready for expert review
- `"status": "planning_complete"` - Planning tool finished
- `"status": "continuation_available"` - Chat/conversation can continue

**Error States:**
- `"status": "files_required_to_continue"` - Need additional files to proceed
- `"status": "validation_failed"` - Input validation error
- `"<tool>_failed"` - Tool-specific failure (e.g., "codereview_failed")

## Best Practices

### File Path Requirements

<critical>
**CRITICAL:** Always use FULL absolute paths, never relative paths
```bash
# Get absolute path
pwd
# Example: /Users/username/project/main.go
```
</critical>

### Model Selection

- **Complex analysis:** Use "o3", "gemini-2.5-pro", "gpt5"
- **Fast tasks:** Use "flash", "mini", "nano"
- **Creative tasks:** Use "gemini-2.5-flash", "gpt-4.1"
- **Check availability:** Use `listmodels` first

### Multi-Step Workflow

1. Start with `total_steps` estimate (can adjust later)
2. Set `next_step_required: true` for intermediate steps
3. Use `continuation_id` from response for follow-up steps
4. End with `next_step_required: false` when complete

### Error Recovery

- **Missing files:** Provide requested files and continue with `continuation_id`
- **Validation errors:** Fix parameters and retry
- **Model unavailable:** Choose different model from `listmodels`
- **Incomplete analysis:** Continue with additional steps using `continuation_id`

## Integration with Development Workflow

### Pre-Commit Validation

Use `precommit` before committing:
```json
{
  "path": "/absolute/path/to/git/repo",
  "focus_on": "security",
  "severity_filter": "high",
  "model": "o3"
}
```

### Code Review Process

1. Use `codereview` for systematic review
2. Follow up with `refactor` for improvement suggestions
3. Use `testgen` for test coverage analysis

### Debugging Workflow

1. Start with `debug` for root cause analysis
2. Use `tracer` for execution flow understanding
3. Apply `analyze` for architectural insights

## Available Models Summary

Use `listmodels` to get current availability. Common models include:

**OpenAI:** gpt5, gpt5-mini, gpt5-nano, o3, o3-mini, o3-pro, o4-mini, gpt-4.1
**Google:** gemini-2.5-pro, gemini-2.0-flash, gemini-2.0-flash-lite, gemini-2.5-flash
**Anthropic (OpenRouter):** claude-opus-4.1, claude-sonnet-4.1, claude-3.5-haiku
**Others:** deepseek-r1, mistral-large, llama-3-sonar

## Critical Validation Checklist

- ✅ `model` parameter always provided
- ✅ File paths are FULL absolute paths (when required)
- ✅ Multi-step parameters complete for complex tools
- ✅ `continuation_id` used for follow-up steps
- ✅ Model availability verified with `listmodels`
- ✅ Error responses handled appropriately
- ✅ Required fields provided for each tool type
