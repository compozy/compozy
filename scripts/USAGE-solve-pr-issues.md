# Complete Guide: Transform and Solve PR Issues

This guide shows you how to transform ai-docs/reviews/\* files into the format expected by `solve_issues.go` and then process them with AI assistance.

## Quick Start

```bash
# 1. Transform monitoring issues
bun scripts/transform-review-issues.ts monitoring

# 2. Process with solve_issues.go
go run scripts/issues/solve_issues.go \
  --pr manual \
  --issues-dir ai-docs/reviews-pr-manual/issues \
  --batch-size 3 \
  --concurrent 2 \
  --ide codex \
  --model gpt-5
```

## Step-by-Step Guide

### Step 1: Transform Review Issues

The `transform-review-issues.ts` script converts ai-docs/reviews/\* files to match the format that `solve_issues.go` expects (the same format generated by `pr-review.ts`).

```bash
# Transform monitoring issues (26 files)
bun scripts/transform-review-issues.ts monitoring

# Transform performance issues (16 files)
bun scripts/transform-review-issues.ts performance

# Custom output directory
bun scripts/transform-review-issues.ts monitoring \
  --output-dir ai-docs/reviews-pr-monitoring/issues
```

**What it does:**

- Reads all `.md` files from `ai-docs/reviews/<category>/`
- Extracts code file paths, priorities, status, and body content
- Transforms to pr-review.ts format:
  - `**File:** \`path:line\`` (required by solve_issues.go)
  - `**Status:** - [ ] UNRESOLVED` (required by solve_issues.go)
  - Descriptive filenames: `001-runtime-bun_manager-runtime-tool-execution-metrics.md`
    - Format: `{number}-{file-slug}-{title-slug}.md`
    - Makes issues easy to identify without opening them
- Creates `_summary.md` with issue listing
- Outputs to `ai-docs/reviews-pr-manual/issues/` by default

### Step 2: Review Transformed Issues

```bash
# Check the transformed files
ls -la ai-docs/reviews-pr-manual/issues/

# Read the summary
cat ai-docs/reviews-pr-manual/issues/_summary.md

# Review a specific issue (note the descriptive filename)
cat ai-docs/reviews-pr-manual/issues/001-runtime-bun_manager-runtime-tool-execution-metrics.md
```

**Example filenames (descriptive and readable):**

```
001-runtime-bun_manager-runtime-tool-execution-metrics.md
002-task-router-exec-async-execution-started-counters.md
003-workflow-router-execute_sync-workflow-poll-metrics.md
004-llm-provider-llm-provider-call-metrics.md
005-mcp-client-mcp-tool-execution-metrics.md
```

Each filename shows:

- Issue number (001, 002, etc.)
- File being reviewed (runtime-bun_manager, task-router-exec, etc.)
- Issue topic (runtime-tool-execution-metrics, etc.)

### Step 3: Process with solve_issues.go

#### Dry Run First (Recommended)

Test without actually running the IDE tool:

```bash
go run scripts/issues/solve_issues.go \
  --pr manual \
  --issues-dir ai-docs/reviews-pr-manual/issues \
  --dry-run
```

This will:

- Group issues by file
- Generate prompts in `.tmp/codex-prompts/pr-manual/`
- Show what would be processed
- Not execute any IDE tool

#### Review Generated Prompts

```bash
# List generated prompts
ls -la .tmp/codex-prompts/pr-manual/

# Read a specific prompt
cat .tmp/codex-prompts/pr-manual/ < prompt-file > .prompt.md
```

#### Run for Real

**Single file processing (sequential):**

```bash
go run scripts/issues/solve_issues.go \
  --pr manual \
  --issues-dir ai-docs/reviews-pr-manual/issues \
  --ide codex \
  --model gpt-5
```

**Batch processing (3 files per batch, sequential):**

```bash
go run scripts/issues/solve_issues.go \
  --pr manual \
  --issues-dir ai-docs/reviews-pr-manual/issues \
  --batch-size 3 \
  --ide codex \
  --model gpt-5
```

**Batch processing with concurrency (2 batches in parallel):**

```bash
go run scripts/issues/solve_issues.go \
  --pr manual \
  --issues-dir ai-docs/reviews-pr-manual/issues \
  --batch-size 3 \
  --concurrent 2 \
  --ide codex \
  --model gpt-5
```

**Using Claude instead of Codex:**

```bash
go run scripts/issues/solve_issues.go \
  --pr manual \
  --issues-dir ai-docs/reviews-pr-manual/issues \
  --batch-size 3 \
  --ide claude
```

### Step 4: Monitor Progress

The script shows a TUI (Terminal UI) with:

- Real-time progress for each batch
- Live stdout/stderr output (last 5 lines)
- Success/failure indicators
- Log file locations

**Keyboard shortcuts:**

- `↑↓` or `j`/`k`: Scroll
- `pgup`/`pgdn` or `b`/`f`: Half page scroll
- `home`/`end` or `g`/`G`: Jump to top/bottom
- `q` or `Ctrl+C`: Quit

**Log files:**
Each batch generates two log files in `.tmp/codex-prompts/pr-<PR>/`:

- `<batch-name>.out.log` - stdout from IDE tool
- `<batch-name>.err.log` - stderr from IDE tool

### Step 5: Review Results

After processing:

```bash
# Check updated summary
cat ai-docs/reviews-pr-manual/issues/_summary.md

# Check grouped summaries
ls -la ai-docs/reviews-pr-manual/issues/grouped/

# Check individual issue files for status updates
grep -r "RESOLVED ✓" ai-docs/reviews-pr-manual/issues/
```

## Command Reference

### transform-review-issues.ts

```bash
bun scripts/transform-review-issues.ts < category > [--output-dir < dir > ]
```

**Arguments:**

- `<category>`: Category to transform (monitoring, performance)

**Options:**

- `--output-dir <dir>`: Custom output directory (default: `ai-docs/reviews-pr-manual/issues`)

### solve_issues.go

```bash
go run scripts/issues/solve_issues.go --pr < num > [options]
```

**Required:**

- `--pr <num>`: Pull request number or identifier (e.g., "manual", "289")

**Options:**

- `--issues-dir <dir>`: Path to issues directory (default: `ai-docs/reviews-pr-<PR>/issues`)
- `--batch-size <n>`: Number of files per batch (default: 1)
- `--concurrent <n>`: Number of batches to process in parallel (default: 1)
- `--ide <tool>`: IDE tool to use: `codex` or `claude` (default: codex)
- `--model <name>`: Model to use (default: gpt-5 for codex, auto for claude)
- `--dry-run`: Generate prompts only, don't execute IDE tool

## Examples

### Example 1: Process all monitoring issues one by one

```bash
# Transform
bun scripts/transform-review-issues.ts monitoring

# Process sequentially
go run scripts/issues/solve_issues.go \
  --pr monitoring \
  --issues-dir ai-docs/reviews-pr-manual/issues
```

### Example 2: Batch process with concurrency

```bash
# Transform
bun scripts/transform-review-issues.ts performance

# Process 5 files per batch, 3 batches in parallel
go run scripts/issues/solve_issues.go \
  --pr performance \
  --issues-dir ai-docs/reviews-pr-manual/issues \
  --batch-size 5 \
  --concurrent 3 \
  --ide codex \
  --model gpt-5
```

### Example 3: Use different IDE tools

```bash
# With Codex
go run scripts/issues/solve_issues.go \
  --pr manual \
  --issues-dir ai-docs/reviews-pr-manual/issues \
  --ide codex \
  --model gpt-5

# With Claude
go run scripts/issues/solve_issues.go \
  --pr manual \
  --issues-dir ai-docs/reviews-pr-manual/issues \
  --ide claude

# With Claude and specific model
go run scripts/issues/solve_issues.go \
  --pr manual \
  --issues-dir ai-docs/reviews-pr-manual/issues \
  --ide claude \
  --model claude-opus-4
```

### Example 4: Test before running

```bash
# 1. Dry run to see what would be processed
go run scripts/issues/solve_issues.go \
  --pr manual \
  --issues-dir ai-docs/reviews-pr-manual/issues \
  --batch-size 3 \
  --dry-run

# 2. Review generated prompts
ls -la .tmp/codex-prompts/pr-manual/
cat .tmp/codex-prompts/pr-manual/batch_001.prompt.md

# 3. If everything looks good, run for real
go run scripts/issues/solve_issues.go \
  --pr manual \
  --issues-dir ai-docs/reviews-pr-manual/issues \
  --batch-size 3
```

## Troubleshooting

### Issue: "No issue files found"

Make sure you transformed the issues first:

```bash
bun scripts/transform-review-issues.ts monitoring
```

### Issue: "All issues are already resolved"

Check if your issue files contain "RESOLVED ✓" in the body. The filter looks for:

- Uppercase "RESOLVED ✓" anywhere in the file
- `**Status:** - [x] RESOLVED` (case-insensitive)
- `- [x] resolved` task list items

### Issue: "CLI not found on PATH"

Install the required IDE tool:

```bash
# For Codex
npm install -g @openai/codex-cli

# For Claude
# Follow installation instructions at https://github.com/anthropics/claude-cli
```

### Issue: Files grouped incorrectly

The script groups by the file path extracted from `**File:** \`path:line\``. Make sure your transformed issues have the correct format.

### Issue: Batch processing too slow

Increase concurrency:

```bash
go run scripts/issues/solve_issues.go \
  --pr manual \
  --issues-dir ai-docs/reviews-pr-manual/issues \
  --batch-size 3 \
  --concurrent 4 # Process 4 batches in parallel
```

### Issue: Want to re-run a specific file

Find the prompt file and run the IDE tool manually:

```bash
# Find the prompt
ls .tmp/codex-prompts/pr-manual/*.prompt.md

# Run manually
cat .tmp/codex-prompts/pr-manual/ < file > .prompt.md \
  | codex --full-auto -m gpt-5 -c model_reasoning_effort=medium exec -
```

## File Structure

After transformation and processing:

```
ai-docs/reviews-pr-manual/
└── issues/
    ├── 001-issue.md              # Individual issue files
    ├── 002-issue.md
    ├── ...
    ├── _summary.md               # Summary of all issues
    └── grouped/                  # Grouped by file (created by solve_issues.go)
        ├── engine_runtime_*.md
        ├── engine_auth_*.md
        └── ...

.tmp/codex-prompts/pr-manual/     # Generated prompts and logs
├── batch_001.prompt.md           # Batch prompt
├── batch_001.out.log            # IDE stdout
├── batch_001.err.log            # IDE stderr
└── ...
```

## Best Practices

1. **Always dry-run first** to verify prompts and grouping
2. **Start with small batches** (2-3 files) to test
3. **Use concurrency carefully** - more isn't always better (depends on your machine)
4. **Review logs** if any batch fails
5. **Check grouped summaries** to verify batching logic
6. **Monitor memory usage** with large batches or high concurrency
7. **Keep batch sizes reasonable** (3-5 files) for better context quality
8. **Test with one category** before processing all categories

## Performance Tips

- **Batch size 3-5**: Good balance between context size and processing speed
- **Concurrent 2-4**: Depends on your CPU cores and IDE tool limits
- **Use Codex for Go code**: Better at system-level refactoring
- **Use Claude for complex logic**: Better at reasoning through architectural changes
- **gpt-5 model**: Best balance of speed and quality for Codex

## What Gets Updated

When solve_issues.go runs successfully:

1. **Individual issue files**: Status changes from `- [ ] UNRESOLVED` to `- [x] RESOLVED ✓`
2. **Grouped files**: Created/updated in `issues/grouped/` with per-file summaries
3. **\_summary.md**: Checkboxes updated to show resolved issues
4. **Code files**: Fixed according to issue descriptions
5. **GitHub threads**: If thread IDs present, resolved via `gh` command (for real PR reviews)

## Next Steps

After processing issues, you should:

1. **Review the changes**: Check what code was modified
2. **Run tests**: `make test` to ensure nothing broke
3. **Run linters**: `make lint` to check code quality
4. **Manual review**: Some issues may need human judgment
5. **Commit changes**: Create a commit with meaningful message

## Credits

- `transform-review-issues.ts`: Transforms ai-docs/reviews/\* to pr-review.ts format
- `solve_issues.go`: Processes issues with AI assistance (port of solve-pr-issues.ts)
- `pr-review.ts`: Exports GitHub PR reviews to markdown format
- Built with ❤️ for the Compozy project
